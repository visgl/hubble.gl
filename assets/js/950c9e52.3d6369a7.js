"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[589],{722:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>V,contentTitle:()=>U,default:()=>q,frontMatter:()=>z,metadata:()=>s,toc:()=>D});const s=JSON.parse('{"id":"website/trips","title":"NYC Trips","description":"","source":"@site/src/examples/website/trips.mdx","sourceDirName":"website","slug":"/website/trips","permalink":"/examples/website/trips","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"Landmark Tour","permalink":"/examples/website/terrain"},"next":{"title":"Kepler.gl","permalink":"/examples/website/kepler"}}');var n=i(4848),r=i(8453),a=i(6540),o=(i(5338),i(7809)),l=i(9861),h=i(6111),c=i(1660),d=i(3252),p=i(1597);const m=[255,255,255],u=1,f=[0,0,1],g=[0,0,1];let y=0;var b=i(6862),v=i(1460),w=i(1313),x=(i(1237),i(5173),i(7958),i(8114),i(4960),i(2649),i(5761),i(7382),i(3158),i(1995),i(6668));const k=i.e(443).then(i.t.bind(i,6443,23)),j=a.forwardRef((function(e,t){return(0,w.A)(e,t,k)}));var C=i(9460),A=i(8469);class T extends A.A{getShaders(){const e=super.getShaders();return e.inject={"vs:#decl":"uniform float trailLength;\nattribute float instanceTimestamps;\nattribute float instanceNextTimestamps;\nvarying float vTime;\n","vs:#main-end":"vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform bool fadeTrail;\nuniform float trailLength;\nuniform float currentTime;\nvarying float vTime;\n","fs:#main-start":"if(vTime > currentTime || (fadeTrail && (vTime < currentTime - trailLength))) {\n  discard;\n}\n","fs:DECKGL_FILTER_COLOR":"if(fadeTrail) {\n  color.a *= 1.0 - (currentTime - vTime) / trailLength;\n}\n"},e}initializeState(){super.initializeState();this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){const{fadeTrail:t,trailLength:i,currentTime:s}=this.props;e.uniforms={...e.uniforms,fadeTrail:t,trailLength:i,currentTime:s},super.draw(e)}}(0,c.A)(T,"layerName","TripsLayer"),(0,c.A)(T,"defaultProps",{fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:e=>e.timestamps}});var _=i(2312);const S={BUILDINGS:"https://raw.githubusercontent.com/visgl/deck.gl-data/master/examples/trips/buildings.json",TRIPS:"https://raw.githubusercontent.com/visgl/deck.gl-data/master/examples/trips/trips-v7.json"},N=new h.$({color:[255,255,255],intensity:1}),L=new class{constructor(e={}){(0,c.A)(this,"id",void 0),(0,c.A)(this,"color",void 0),(0,c.A)(this,"intensity",void 0),(0,c.A)(this,"type","point"),(0,c.A)(this,"position",void 0),(0,c.A)(this,"attenuation",void 0),(0,c.A)(this,"projectedLight",void 0);const{color:t=m}=e,{intensity:i=u}=e,{position:s=g}=e;this.id=e.id||"point-".concat(y++),this.color=t,this.intensity=i,this.type="point",this.position=s,this.attenuation=function(e){if(e.attenuation)return e.attenuation;if("intensity"in e)return[0,0,e.intensity||0];return f}(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:t}=this,i=e.context.viewport,{coordinateSystem:s,coordinateOrigin:n}=e.props,r=(0,d.R)(this.position,{viewport:i,coordinateSystem:s,coordinateOrigin:n,fromCoordinateSystem:i.isGeospatial?p.rf.LNGLAT:p.rf.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return t.color=this.color,t.intensity=this.intensity,t.position=r,t}}({color:[255,255,255],intensity:2,position:[-74.05,40.7,8e3]}),E={buildingColor:[74,80,87],trailColor0:[253,128,93],trailColor1:[23,184,190],material:{ambient:.1,diffuse:.6,shininess:32,specularColor:[60,64,70]},effects:[new b.A({ambientLight:N,pointLight:L})]},F={longitude:-74,latitude:40.72,zoom:13,pitch:45,bearing:0},K=[[[-74,40.7],[-74.02,40.7],[-74.02,40.72],[-74,40.72]]],R={width:1280,height:720},M={webm:{quality:.8},png:{archive:"zip"},jpeg:{archive:"zip",quality:.8},gif:{sampleInterval:1e3,width:R.width,height:R.height}},O={start:0,end:5e3,framerate:30},P=e=>{let{children:t}=e;return(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",position:"relative",backgroundColor:"#11183c",overflow:"hidden"},children:t})},B=(0,a.forwardRef)(((e,t)=>{const i=(0,x.A)((()=>new v.A(Object.assign({},e,{interleaved:!0}))));return i.setProps(e),function(e,t){e&&("function"==typeof e?e(t):e.current=t)}(t,i._deck),null}));function I(e){let{mapStyle:t="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json"}=e;const i=(0,a.useRef)(null),s=(0,a.useRef)(null),[r,h]=(0,a.useState)(!1),c=(0,o.Lp)({getLayers:e=>e.applyLayerKeyframes([new T({id:"trips",data:S.TRIPS,getPath:e=>e.path,getTimestamps:e=>e.timestamps,getColor:e=>0===e.vendor?E.trailColor0:E.trailColor1,opacity:1,widthMinPixels:2,rounded:!0,trailLength:180,shadowEnabled:!1}),new C.A({id:"buildings",data:S.BUILDINGS,extruded:!0,wireframe:!1,opacity:.5,getPolygon:e=>e.polygon,getElevation:e=>e.height,getFillColor:E.buildingColor,material:E.material}),new C.A({id:"ground",data:K,getPolygon:e=>e,stroked:!1,getFillColor:[0,0,0,0]})]),layerKeyframes:[{id:"trips",timings:[700,O.end],keyframes:[{currentTime:700},{currentTime:1800}]}]}),{deckProps:d,mapProps:p,adapter:m,cameraFrame:u,setCameraFrame:f}=(0,o.pp)({deckRef:i,mapRef:s,deckAnimation:c,initialViewState:F}),g=(0,a.useCallback)((e=>{let{viewState:t}=e;m.animationManager.setKeyframes("deck",{cameraKeyframe:{timings:[0,O.end],keyframes:[{longitude:t.longitude,latitude:t.latitude,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing},{longitude:t.longitude,latitude:t.latitude,zoom:t.zoom,bearing:t.bearing+180,pitch:t.pitch}],easings:[_.am]}}),f(t)}),[O.end]);return(0,a.useEffect)((()=>g({viewState:u})),[]),(0,n.jsxs)(P,{children:[(0,n.jsx)("div",{style:{position:"relative"},children:(0,n.jsx)(j,Object.assign({ref:s,mapStyle:t},p,u,{style:{width:R.width,height:R.height},onMove:g,children:(0,n.jsx)(B,Object.assign({ref:i},d,{effects:E.effects}))}))}),(0,n.jsx)(l.A,{adapter:m,busy:r,setBusy:h,formatConfigs:M,timecode:O,filename:"trips"})]})}const z={},U="NYC Trips",V={},D=[];function G(e){const t={h1:"h1",header:"header",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"nyc-trips",children:"NYC Trips"})}),"\n","\n",(0,n.jsx)(I,{})]})}function q(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(G,{...e})}):G(e)}},5846:(e,t,i)=>{i.d(t,{A:()=>b});var s=i(7036),n=i(1111),r=i(2312),a=i(1365);class o extends s.E{constructor(e){let{features:t=[],timings:i,keyframes:s,easings:r=n.s,interpolators:a="linear"}=e;super([]),this.activeFeatures={},this._setActiveFeatures=this._setActiveFeatures.bind(this),this.getFrame=this.getFrame.bind(this),this.set=this.set.bind(this),this.activeFeatures=t.reduce(((e,t)=>(e[t]=!1,e)),{}),this.set({timings:i,keyframes:s,easings:r,interpolators:a})}set(e){let{timings:t,keyframes:i,easings:s=n.s,interpolators:r="linear"}=e;if(!i||0===i.length)throw new Error("There must be at least one keyframe");const a=function(e,t){if("string"==typeof t){const i=[];for(let s=0;s<e.length-1;s++)i.push(t);return i}if(e.length-1!==t.length)throw new Error("There must be one fewer interpolator than keyframes");return t}(i,r),o=function(e,t){if("function"==typeof t){const i=[];for(let s=0;s<e.length-1;s++)i.push(t);return i}if(e.length-1!==t.length)throw new Error("There must be one fewer easing than keyframes");return t}(i,s),l=function(e,t){if("number"==typeof t){const i=[];let s=0;for(let n=0;n<e.length;n++)i.push(s),s+=t;return i}if(e.length!==t.length)throw new Error("There must be same number of timings as keyframes");return t}(i,t);this._setActiveFeatures(i);const h=function(e,t,i,s){return t.map(((t,n)=>0===n?[e[n],Object.assign({},t,{ease:void 0,interpolate:void 0})]:[e[n],Object.assign({},t,{ease:i[n-1],interpolate:s[n-1]})]))}(l,i,o,a);this.keyframes=i,this.timings=t,this.easings=s,this.interpolators=r,this.setKeyFrames(h)}getFrame(){const e=this.factor,t=this.getStartData(),i=this.getEndData(),s={};return Object.keys(this.activeFeatures).forEach((n=>{this.activeFeatures[n]&&(s[n]=function(e,t,i){return void 0===i&&(i=r.sn),(0,a.G)([0,1],[e,t],{ease:i})}(t[n],i[n],i.ease)(e))})),s}_setActiveFeatures(e){const t=e[0];this.activeFeatures=Object.keys(t).reduce(((e,i)=>(void 0!==t[i]&&(e[i]=!0),e)),this.activeFeatures)}}const l=o;var h=i(3276),c=i(4692);const d=["bearing","pitch"],p={speed:1.2,curve:1.414};class m extends l{constructor(e){let{timings:t,keyframes:i,easings:s,interpolators:n,width:r,height:a}=e;super({timings:t,keyframes:i,easings:s,interpolators:n,features:["latitude","longitude","zoom","pitch","bearing"]}),this.width=r,this.height=a}getFrame(){const e=this.factor,t=this.getStartData(),i=this.getEndData();if("flyTo"===i.interpolate){if(!this.width||!this.height)throw new Error("width and height must be defined to use flyTo interpolator");const s=this.getEndTime()-this.getStartTime();return function(e,t,i,s){const n=(0,h.rj)(e,t,t.ease(i),Object.assign({},p,s));for(const r of d)n[r]=(0,c.Cc)(e[r]||0,t[r]||0,t.ease(i));return n}(Object.assign({},t,{width:this.width,height:this.height}),i,e,{maxDuration:s})}return super.getFrame()}}function u(e){return e&&e[0]?Object.keys(e[0]):[]}class f extends l{constructor(e){let{id:t,features:i,timings:s,keyframes:n,easings:r}=e;super({timings:s,keyframes:n,easings:r,features:i||u(n)}),this.id=t}}class g{constructor(e){let{id:t}=e;this.unattachedKeyframes=[],this.id=t,this.unattachedKeyframes=[]}attachKeyframes(e){for(const t of this.unattachedKeyframes)t.animationHandle&&e.detachAnimation(t.animationHandle),t.animationHandle=e.attachAnimation(t,void 0);this.unattachedKeyframes=[]}getKeyframes(){throw new Error("not implemented")}setKeyframes(e){throw new Error("not implemented")}animator(e){throw new Error("not implemented")}draw(){return this.animator(this)}}function y(){}class b extends g{constructor(e){let{id:t="deck",cameraKeyframe:i,getLayers:s=e=>[],layerKeyframes:n=[],onLayersUpdate:r=y,onCameraUpdate:a=y}=e;super({id:t}),this.layerKeyframes={},this.layerKeyframes={},this.onLayersUpdate=r,this.onCameraUpdate=a,this.getLayers=s,this.setKeyframes({cameraKeyframe:i,layerKeyframes:n}),this.draw()}setOnLayersUpdate(e){this.onLayersUpdate=e}setOnCameraUpdate(e){this.onCameraUpdate=e}setGetLayers(e){this.getLayers=e,this.draw()}setKeyframes(e){let{layerKeyframes:t=[],cameraKeyframe:i,timeline:s}=e;this.cameraKeyframe&&i?this.cameraKeyframe.set(i):i&&(this.cameraKeyframe=new m(i),this.unattachedKeyframes.push(this.cameraKeyframe)),t&&t.length>0&&(this.layerKeyframes=t.reduce(((e,t)=>(e[t.id]?e[t.id].set(t):(e[t.id]=new f(t),this.unattachedKeyframes.push(e[t.id])),e)),this.layerKeyframes)),s&&this.attachKeyframes(s)}getKeyframes(){return{cameraKeyframe:this.cameraKeyframe,layerKeyframes:this.layerKeyframes}}animator(e){e.cameraKeyframe&&e.onCameraUpdate(e.cameraKeyframe.getFrame()),Object.values(e.layerKeyframes).length>0&&e.onLayersUpdate(this.getLayers(e))}applyLayerKeyframes(e){return e.map((e=>{if(this.layerKeyframes[e.id]){const t=this.layerKeyframes[e.id].getFrame();return e.clone(Object.assign({},t,{updateTriggers:t}))}return e}))}}},1353:(e,t,i)=>{i.d(t,{A:()=>s});class s{constructor(e){void 0===e&&(e={}),this.extension="",this.mimeType="",this.framerate=e.framerate||30}start(){throw new Error("Encoder: Implement a start function")}async add(e){throw new Error("Encoder: Implement an add function")}async save(){throw new Error("Encoder: Implement a save function")}}},1750:(e,t,i)=>{i.d(t,{A:()=>n});var s=i(1353);class n extends s.A{start(){this.af&&cancelAnimationFrame(this.af)}async add(e){return new Promise((e=>{this.af&&cancelAnimationFrame(this.af),this.af=requestAnimationFrame((()=>e()))}))}async save(){return this.af&&cancelAnimationFrame(this.af),await Promise.resolve(null)}}},1111:(e,t,i)=>{i.d(t,{_:()=>s,s:()=>n});const s=e=>1===e?1:0,n=e=>e},9861:(e,t,i)=>{i.d(t,{A:()=>me});var s=i(6540),n=i(6065),r=i(4848);const a=n.Ay.div.withConfig({displayName:"input__InputContainer",componentId:"sc-4i6k7t-0"})(["position:relative;width:100%;font:14px / 20px Helvetica,Arial,sans-serif;box-sizing:border-box;&:last-child{margin-bottom:20px;}> *{vertical-align:middle;white-space:nowrap;}label{display:inline-block;width:40%;margin-right:10%;margin-top:2px;margin-bottom:2px;}input,a,button,select{background:#fff;font-size:0.9em;text-transform:none;text-overflow:ellipsis;overflow:hidden;display:inline-block;padding:0 4px;margin:0;width:50%;height:20px;line-height:1.833;text-align:left;}button{color:initial;}button:disabled{color:#aaa;cursor:default;background:#eee;}input{border:solid 1px #ccc;&:disabled{background:#eee;}&[type='checkbox']{height:auto;}}.tooltip{left:50%;top:24px;opacity:0;pointer-events:none;transition:opacity 200ms;}&:hover .tooltip{opacity:1;}"]);class o extends s.PureComponent{_onChange(e){const{value:t,type:i}=e.target;let s=t;"checkbox"===i&&(s=e.target.checked),"range"===i&&(s=Number(t),void 0!==this.props.min&&(s=Math.max(this.props.min,s)),void 0!==this.props.max&&(s=Math.min(this.props.max,s))),this.props.onChange(this.props.name,s)}_resetFunction(){return this.props.onChange(this.props.name,this.props.altValue)}render(){const{displayName:e,type:t,displayValue:i,disabled:s}=this.props,n=Object.assign({},this.props);if(delete n.displayName,delete n.displayValue,delete n.altType,delete n.altValue,"link"===t)return(0,r.jsxs)("div",{className:"input",children:[(0,r.jsx)("label",{children:e}),(0,r.jsx)("a",{href:i,target:"_new",children:i})]});if("function"===t||"json"===t){const t="altValue"in this.props;return(0,r.jsxs)("div",{className:"input",children:[(0,r.jsx)("label",{children:e}),(0,r.jsx)("button",{type:"button",disabled:!t||s,onClick:this._resetFunction.bind(this),children:i})]})}return"select"===t?(0,r.jsx)(a,{children:(0,r.jsxs)("div",{className:"input",children:[(0,r.jsx)("label",{children:e}),(0,r.jsx)("select",{disabled:s,onChange:this._onChange.bind(this),value:i,children:n.options.map(((e,t)=>(0,r.jsx)("option",{value:e,children:e},t)))})]})}):("checkbox"===t&&(n.checked=n.value),(0,r.jsxs)(a,{children:[(0,r.jsx)("label",{children:e}),(0,r.jsxs)("div",{className:"tooltip",children:[e,": ",String(i)]}),(0,r.jsx)("input",Object.assign({},n,{value:i,onChange:this._onChange.bind(this)}))]}))}}var l=i(1750),h=i(7273),c=i(1353);class d extends c.A{constructor(e){super(e),this.gifBuilder=null,this.source="images",this.mimeType="image/gif",this.extension=".gif";let t={width:720,height:480,numWorkers:4,sampleInterval:10,jpegQuality:1};e.gif&&(t=Object.assign({},t,e.gif)),this.options=t,this.start=this.start.bind(this),this.add=this.add.bind(this),this.save=this.save.bind(this)}start(){this.gifBuilder=new h.A(Object.assign({source:this.source},this.options,{interval:1/this.framerate}))}async add(e){if("images"===this.source){const t=e.toDataURL("image/jpeg",this.options.jpegQuality);await this.gifBuilder.add(t)}}async save(){return fetch(await this.gifBuilder.build()).then((e=>e.blob()))}}var p=i(8964),m=i.n(p);class u extends c.A{constructor(e){super(e),this.quality=.8,e.webm&&e.webm.quality&&(this.quality=e.webm.quality);"image/webp"!==document.createElement("canvas").toDataURL("image/webp").substr(5,10)&&console.error("WebP not supported - try another export format"),this.extension=".webm",this.mimeType="video/webm",this.videoWriter=null,this.start=this.start.bind(this),this.add=this.add.bind(this),this.save=this.save.bind(this)}start(){this.videoWriter=new(m())({quality:this.quality,fileWriter:null,fd:null,frameRate:this.framerate})}async add(e){this.videoWriter.addFrame(e),await Promise.resolve()}async save(){return this.videoWriter.complete()}}const f=u;function g(e){let t;const i=new Uint8Array(e);for(t=0;t<e;t+=1)i[t]=0;return i}function y(e,t,i){void 0===i&&(i=8);const s=e.toString(i);return"000000000000".substr(s.length+12-t)+e}const b=[{field:"fileName",length:100},{field:"fileMode",length:8},{field:"uid",length:8},{field:"gid",length:8},{field:"fileSize",length:12},{field:"mtime",length:12},{field:"checksum",length:8},{field:"type",length:1},{field:"linkName",length:100},{field:"ustar",length:8},{field:"owner",length:32},{field:"group",length:32},{field:"majorNumber",length:8},{field:"minorNumber",length:8},{field:"filenamePrefix",length:155},{field:"padding",length:12}];let v;const w=512;const x=class{constructor(e){this.written=0,v=(e||20)*w,this.out=g(v),this.blocks=[],this.length=0,this.save=this.save.bind(this),this.clear=this.clear.bind(this),this.append=this.append.bind(this)}append(e,t,i){var s;let n;if(void 0===i&&(i={}),"string"==typeof t)t=function(e,t,i){let s,n;for(void 0===i&&(i=0),t=t||g(e.length),s=0,n=e.length;s<n;s+=1)t[i]=e.charCodeAt(s),i+=1;return t}(t);else if(null!=(s=t)&&s.constructor&&t.constructor!==Uint8Array.prototype.constructor){var r;throw"Invalid input type. You gave me: "+(null==(r=t.constructor.toString().match(/function\s*([$A-Za-z_][0-9A-Za-z_]*)\s*\(/))?void 0:r.at(1))}const a=i.mode||4095&parseInt("777",8),o=i.mtime||Math.floor(Number(new Date)/1e3),l=i.uid||0,h=i.gid||0,c={fileName:e,fileMode:y(a,7),uid:y(l,7),gid:y(h,7),fileSize:y(t.length,11),mtime:y(o,11),checksum:"        ",type:"0",ustar:"ustar  ",owner:i.owner||"",group:i.group||""};n=0,Object.keys(c).forEach((e=>{let t;const i=c[e];let s;for(t=0,s=i.length;t<s;t+=1)n+=i.charCodeAt(t)})),c.checksum=y(n,6)+"\0 ";const d=function(e,t){const i=g(512);let s=0;return b.forEach((t=>{const n=e[t.field]||"";let r,a;for(r=0,a=n.length;r<a;r+=1)i[s]=n.charCodeAt(r),s+=1;s+=t.length-r})),"function"==typeof t?t(i,s):i}(c),p=Math.ceil(d.length/w)*w,m=Math.ceil(t.length/w)*w;this.blocks.push({header:d,input:t,headerLength:p,inputLength:m})}save(){const e=[],t=[];let i=0;const s=Math.pow(2,20);let n=[];return this.blocks.forEach((e=>{i+e.headerLength+e.inputLength>s&&(t.push({blocks:n,length:i}),n=[],i=0),n.push(e),i+=e.headerLength+e.inputLength})),t.push({blocks:n,length:i}),t.forEach((t=>{const i=new Uint8Array(t.length);let s=0;t.blocks.forEach((e=>{i.set(e.header,s),s+=e.headerLength,i.set(e.input,s),s+=e.inputLength})),e.push(i)})),e.push(new Uint8Array(1024)),new Blob(e,{type:"octet/stream"})}clear(){this.written=0,this.out=g(v)}},k={recordsPerBlock:20};class j{static get properties(){return{id:"tar",name:"TAR",extensions:["tar"],mimeType:"application/x-tar",builder:j,options:k}}constructor(e){this.options=Object.assign({},k,e),this.tape=new x(this.options.recordsPerBlock),this.count=0}addFile(e,t){this.tape.append(t,new Uint8Array(e)),this.count++}async build(){return new Response(this.tape.save()).arrayBuffer()}}function C(e){return String("0000000"+e).slice(-7)}async function A(e,t,i){const s=e.toDataURL(t,i),n=await fetch(s);return await n.arrayBuffer()}var T=i(9147),_=i(3790);const S="tar",N="zip";class L extends c.A{constructor(e){switch(super(e),this.tarBuilder=null,this.filemap={},this.options={quality:1,archive:S},e.jpeg&&(this.options=Object.assign({},e.jpeg)),this.options.quality=this.options.quality||1,this.options.archive=this.options.archive||S,this.options.archive){case S:this.mimeType=j.properties.mimeType,this.extension="."+j.properties.extensions[0];break;case N:var t,i;this.mimeType=(null==(t=_.V.mimeTypes)?void 0:t[0])||"",this.extension="."+(null==(i=_.V.extensions)?void 0:i[0]);break;default:throw new Error("Unsupported archive type [zip, tar]: "+this.options.archive)}}start(){this.tarBuilder=new j({}),this.filemap={}}async add(e){const t=".jpg",i=await A(e,"image/jpeg",this.options.quality);switch(this.options.archive){case S:{if(!this.tarBuilder)break;const e=C(this.tarBuilder.count)+t;this.tarBuilder.addFile(i,e);break}case N:{const e=C(Object.keys(this.filemap).length)+t;this.filemap[e]=i;break}default:throw new Error("Unsupported archive type [zip, tar]: "+this.options.archive)}}async save(){switch(this.options.archive){case S:{if(!this.tarBuilder)break;const e=await this.tarBuilder.build();return new Blob([e],{type:j.properties.mimeType})}case N:{var e;const t=await(0,T.lF)(this.filemap,_.V);return new Blob([t],{type:null==(e=_.V.mimeTypes)?void 0:e[0]})}default:throw new Error("Unsupported archive type [zip, tar]: "+this.options.archive)}return null}}const E=L,F="tar",K="zip";class R extends c.A{constructor(e){switch(super(e),this.tarBuilder=null,this.filemap={},this.options={archive:F},e.png&&(this.options=Object.assign({},e.png)),this.options.archive=this.options.archive||F,this.options.archive){case F:this.mimeType=j.properties.mimeType,this.extension="."+j.properties.extensions[0];break;case K:var t,i;this.mimeType=(null==(t=_.V.mimeTypes)?void 0:t[0])||"",this.extension="."+(null==(i=_.V.extensions)?void 0:i[0]);break;default:throw new Error("Unsupported archive type [zip, tar]: "+this.options.archive)}}start(){this.tarBuilder=new j({}),this.filemap={}}async add(e){const t=".png",i=await A(e,"image/png");switch(this.options.archive){case F:{if(!this.tarBuilder)break;const e=C(this.tarBuilder.count)+t;this.tarBuilder.addFile(i,e);break}case K:{const e=C(Object.keys(this.filemap).length)+t;this.filemap[e]=i;break}default:throw new Error("Unsupported archive type [zip, tar]: "+this.options.archive)}}async save(){switch(this.options.archive){case F:{if(!this.tarBuilder)break;const e=await this.tarBuilder.build();return new Blob([e],{type:j.properties.mimeType})}case K:{var e;const t=await(0,T.lF)(this.filemap,_.V);return new Blob([t],{type:null==(e=_.V.mimeTypes)?void 0:e[0]})}default:throw new Error("Unsupported archive type [zip, tar]: "+this.options.archive)}return null}}const M=R,O="Preview",P="WebM",B="JPEG Frames",I="PNG Frames",z="GIF",U=[O,P,B,I,z],V={[O]:l.A,[z]:d,[P]:f,[B]:E,[I]:M};function D(e){let{disabled:t,encoder:i,setEncoder:s}=e;return(0,r.jsx)(o,{type:"select",disabled:t,displayName:"Encoder",displayValue:i,onChange:(e,t)=>s(t),options:U})}var G=i(5556),q=i.n(G),H=i(8587);const W=["height","width","viewBox","style","children","predefinedClassName","className","colors","totalColor"];class $ extends s.Component{render(){const e=this.props,{height:t,width:i,viewBox:s,style:n,children:a,predefinedClassName:o,className:l,colors:h,totalColor:c}=e,d=(0,H.A)(e,W),p=t,m=i||p,u=Array.isArray(h)&&c&&((e,t)=>new Array(e).fill(1).reduce(((e,i,s)=>e+".cr"+(s+1)+" {fill:"+t[s%t.length]+";}"),""))(c,h);return(0,r.jsxs)("svg",Object.assign({viewBox:s,width:m,height:p,style:n,className:o+" "+l},d,{children:[u?(0,r.jsx)("style",{type:"text/css",children:u}):null,a]}))}}$.displayName="Base Icon",$.propTypes={height:q().string,width:q().string,viewBox:q().string,children:q().node,predefinedClassName:q().string,className:q().string},$.defaultProps={height:null,width:null,viewBox:"0 0 64 64",predefinedClassName:"",className:"",style:{fill:"currentColor"}};class Y extends s.Component{render(){return(0,r.jsx)($,Object.assign({},this.props,{children:(0,r.jsx)("path",{d:"M16 4c.552 0 1 .448 1 1v4.2l5.213-3.65c.226-.158.538-.103.697.124.058.084.09.184.09.286v12.08c0 .276-.224.5-.5.5-.103 0-.203-.032-.287-.09L17 14.8V19c0 .552-.448 1-1 1H2c-.552 0-1-.448-1-1V5c0-.552.448-1 1-1h14zm-6 4H8v4H5l4 4 4-4h-3V8z"})}))}}Y.propTypes={height:q().string},Y.defaultProps={height:"16px",predefinedClassName:"data-ex-icons-download-video",viewBox:"0 0 24 24"};var J=i(801),Q=i(8950);const Z=async(e,t)=>{const i=await(0,J.q)(e,Q.p),s={};for(const n in i)s[n]=URL.createObjectURL(new Blob([i[n]],{type:t===B?"image/jpeg":"image/png"}));return s},X=n.Ay.video.withConfig({displayName:"render-player__VideoPlayer",componentId:"sc-1oi3ufw-0"})(["margin:8px 0;width:100%;"]),ee=n.Ay.img.withConfig({displayName:"render-player__GifPlayer",componentId:"sc-1oi3ufw-1"})(["margin:8px 0;width:100%;"]),te=n.Ay.div.withConfig({displayName:"render-player__ScrollBox",componentId:"sc-1oi3ufw-2"})(["width:500px;height:400px;position:relative;overflow:auto;margin:8px 0;"]),ie=n.Ay.div.withConfig({displayName:"render-player__ImageGallery",componentId:"sc-1oi3ufw-3"})(["display:flex;flex-wrap:wrap;gap:8px;"]),se=n.Ay.img.withConfig({displayName:"render-player__Thumbnail",componentId:"sc-1oi3ufw-4"})(["width:64px;"]);function ne(e){let{encoder:t,blob:i}=e;const[n,a]=(0,s.useState)(""),[o,l]=(0,s.useState)({});switch((0,s.useEffect)((()=>{a("")}),[t]),(0,s.useEffect)((()=>{if(i)switch(t){case z:case P:a(URL.createObjectURL(i));break;case I:case B:"application/zip"===i.type&&Z(i).then(l)}else a(""),l({})}),[i]),t){case P:return(0,r.jsx)(X,{src:n,controls:!0,autoPlay:!0});case z:return(0,r.jsx)(ee,{src:n});case I:case B:return(0,r.jsx)(te,{children:(0,r.jsx)("div",{style:{position:"absolute"},children:(0,r.jsx)(ie,{children:Object.entries(o).map((e=>{let[t,i]=e;return(0,r.jsx)(se,{src:i,title:t},t)}))})})});default:return null}}const re=n.Ay.div.withConfig({displayName:"basic-controls__RenderResult",componentId:"sc-1bx6uh6-0"})(["position:absolute;z-index:1;top:0;right:0;background-color:#fff;margin:24px;padding:10px 24px;box-shadow:rgba(0,0,0,0.16) 0px 1px 4px;min-width:300px;max-height:calc(100% - 48px);"]),ae=n.Ay.div.withConfig({displayName:"basic-controls__RenderControls",componentId:"sc-1bx6uh6-1"})([""]),oe=n.Ay.div.withConfig({displayName:"basic-controls__ButtonGroup",componentId:"sc-1bx6uh6-2"})(["display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;justify-content:flex-end;"]),le=n.Ay.div.withConfig({displayName:"basic-controls__Result",componentId:"sc-1bx6uh6-3"})(["display:",";max-width:500px;"],(e=>e.$show?"block":"none")),he=n.Ay.div.withConfig({displayName:"basic-controls__Status",componentId:"sc-1bx6uh6-4"})(["display:flex;align-items:center;"]),ce=n.Ay.h3.withConfig({displayName:"basic-controls__H3",componentId:"sc-1bx6uh6-5"})(["font-size:16px;margin:8px 0;font-family:Helvetica,Arial,sans-serif;"]),de=n.Ay.div.withConfig({displayName:"basic-controls__Download",componentId:"sc-1bx6uh6-6"})(["color:blue;cursor:pointer;padding:0 8px;display:",";"],(e=>e.$show?"flex":"none")),pe=n.Ay.div.withConfig({displayName:"basic-controls__TogglePlayer",componentId:"sc-1bx6uh6-7"})(["font-family:Helvetica,Arial,sans-serif;display:inline-block;user-select:none;margin:8px 0;text-decoration:underline;float:right;&:hover{color:blue;}"]);function me(e){let{children:t,adapter:i,busy:n,setBusy:a,formatConfigs:o,timecode:l,embed:h=!0,filename:c}=e;const[d,p]=(0,s.useState)(P),[m,u]=(0,s.useState)(void 0),[f,g]=(0,s.useState)(void 0),[y,b]=(0,s.useState)(!0),v=(0,s.useMemo)((()=>{switch(f){case"in-progress":return"Rendering animation...";case"saving":return"Processing render...";case"rendered":return"Render complete!";default:return"Renderer idle..."}}),[f]);(0,s.useEffect)((()=>{u(void 0),g(void 0)}),[d]);const w=(0,s.useCallback)((e=>{u(e),g("rendered")}),[]),x=(0,s.useCallback)((()=>{i.render({Encoder:V[d],formatConfigs:o,filename:c,timecode:l,onStopped:()=>g("saving"),onComplete:()=>a(!1),onSave:h&&w}),g("in-progress"),a(!0)}),[i,w,d,h,o,l,c]),k=(0,s.useCallback)((()=>{i.stop({onStopped:()=>g("saving"),onComplete:()=>a(!1),onSave:h&&w})}),[i,w,h]);return(0,r.jsx)(re,{children:(0,r.jsxs)("div",{children:[(0,r.jsxs)(he,{children:[(0,r.jsx)(ce,{children:v}),(0,r.jsx)(de,{$show:Boolean(m),title:"Download",onClick:()=>{i.videoCapture.download(m)},children:(0,r.jsx)(Y,{height:"18px"})})]}),(0,r.jsxs)(ae,{children:[(0,r.jsx)(D,{disabled:n,encoder:d,setEncoder:p}),(0,r.jsxs)(oe,{children:[(0,r.jsx)("button",{disabled:n,onClick:x,children:"Render"}),(0,r.jsx)("button",{disabled:!n||"saving"===f,onClick:k,children:"Interrupt"})]})]}),(0,r.jsxs)(le,{$show:Boolean(m),children:[(0,r.jsx)(pe,{onClick:()=>b(!y),children:y?"Hide Player":"Show Player"}),y&&(0,r.jsx)(ne,{encoder:d,blob:m})]}),(0,r.jsx)("div",{style:{marginTop:"8px"},children:t})]})})}},7809:(e,t,i)=>{i.d(t,{Gg:()=>m,Lp:()=>u,pp:()=>f,E6:()=>p});var s=i(6540),n=i(1750),r=i(6271);class a{constructor(e){let{timeline:t,animations:i=[]}=e;this.animations={},this.timeline=t||new r.K;for(const s of i)this.attachAnimation(s)}attachAnimation(e){e.attachKeyframes(this.timeline),this.animations[e.id]=e}setKeyframes(e,t){this.animations[e].setKeyframes(Object.assign({timeline:this.timeline},t))}getKeyframes(e){return this.animations[e].getKeyframes()}getAnimation(e){return this.animations[e]}draw(){Object.values(this.animations).forEach((e=>e.draw()))}}var o=i(56),l=i.n(o);class h{constructor(){this.recording=!1,this.capturing=!1,this.timeMs=0,this.onStop=null,this.recording=!1,this.capturing=!1,this.timeMs=0,this.timecode=null,this.encoder=null,this.filename=null,this._getNextTimeMs=this._getNextTimeMs.bind(this),this._step=this._step.bind(this),this._capture=this._capture.bind(this),this.capture=this.capture.bind(this),this.render=this.render.bind(this),this.download=this.download.bind(this),this.stop=this.stop.bind(this),this._save=this._save.bind(this)}isRecording(){return this.recording}render(e){let{Encoder:t,formatConfigs:i,timecode:s,filename:n,onStop:r}=e;this.isRecording()||(console.time("render"),this.filename=this._sanitizeFilename(n),this.timecode=this._sanatizeTimecode(s),console.log("Starting recording for "+this.timecode.duration+"ms."),this.onStop=r,this.encoder=new t(Object.assign({},i,{framerate:this.timecode.framerate})),this.recording=!0,this.encoder.start())}capture(e,t){!this.capturing&&this.isRecording()&&(this.capturing=!0,this._capture(e).then((e=>{if(this.capturing=!1,"next-frame"===e.kind)t(e.nextTimeMs);else if("stop"===e.kind){var i;null==(i=this.onStop)||i.call(this)}else console.log(e)})))}stop(e){let{onComplete:t,onSave:i,onStopped:s,abort:n=!1}=e;if(this.isRecording()){console.log("Stopped recording. Recorded for "+this.timeMs+"ms."),this.recording=!1,this.capturing=!1,s&&s(),console.timeEnd("render");const e=()=>{t&&t(),this.timecode=null,this.onStop=void 0};n||this._save(i).then(e),e()}}download(e){return e&&l()(e,this.filename+this.encoder.extension,this.encoder.mimeType),!1}async _save(e){e||(e=this.download),console.time("save"),await this.encoder.save().then(e).then((()=>console.timeEnd("save")))}_sanitizeFilename(e){return e||(e=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}()),e}_sanatizeTimecode(e){const t=Object.assign({duration:void 0},e);if(t.start||(t.start=0),this.timeMs=t.start,t.duration||(t.duration=t.end-t.start),t.duration<=0)throw new Error("Invalid recording length ("+t.duration+"ms).  Must be greater than 0.");return t}async _capture(e){return this.isRecording()?await this.encoder.add(e).then(this._step).catch((e=>({kind:"error",error:e}))):{kind:"error",error:"NOT_RECORDING"}}_step(){const e=this._getNextTimeMs();return e>this.timecode.end?{kind:"stop"}:(this.timeMs=e,{kind:"next-frame",nextTimeMs:e})}_getNextTimeMs(){const e=Math.floor(1e3/this.timecode.framerate);return this.timeMs+e}}class c{constructor(e){let{animationManager:t,glContext:i}=e;this.animationManager=t||new a({}),this.glContext=i,this.videoCapture=new h,this.shouldAnimate=!1,this.enabled=!1,this.getProps=this.getProps.bind(this),this.render=this.render.bind(this),this.stop=this.stop.bind(this),this.seek=this.seek.bind(this)}setDeck(e){this.deck=e}getProps(e){let{deck:t,onNextFrame:i,extraProps:s}=e;t&&(this.deck=t);const n={_animate:this.shouldAnimate};return i&&(n.onAfterRender=()=>this.onAfterRender(i)),this.enabled?n.controller=!1:n.controller=!0,this.glContext&&(n.gl=this.glContext),Object.assign({},s,n)}render(e){let{Encoder:t=n.A,formatConfigs:i={},filename:s,timecode:r={start:0,end:0,framerate:30},onStopped:a,onSave:o,onComplete:l}=e;this.shouldAnimate=!0,this.videoCapture.render({Encoder:t,formatConfigs:i,timecode:r,filename:s,onStop:()=>this.stop({onStopped:a,onSave:o,onComplete:l})}),this.enabled=!0,this.seek({timeMs:r.start})}stop(e){let{onStopped:t,onSave:i,onComplete:s,abort:n}=e;this.enabled=!1,this.shouldAnimate=!1,this.videoCapture.stop({onStopped:t,onSave:i,onComplete:s,abort:n})}seek(e){let{timeMs:t}=e;this.animationManager.timeline.setTime(t),this.animationManager.draw()}onAfterRender(e,t){void 0===t&&(t=!0);const i=this.deck&&this.deck.props.layers.every((e=>e.isLoaded));if(this.videoCapture.isRecording()&&i&&t){const t=this.deck.canvas;this.videoCapture.capture(t,(t=>{this.seek({timeMs:t}),e(t)}))}}}var d=i(5846);function p(){const[,e]=(0,s.useState)({});return(0,s.useCallback)((()=>e({})),[])}function m(e,t){void 0===t&&(t=void 0);const[i,n]=(0,s.useState)([]),[r,a]=(0,s.useState)(t);return{adapter:(0,s.useMemo)((()=>{const i=new c({});return e.setOnLayersUpdate(n),t&&e.setOnCameraUpdate(a),i.animationManager.attachAnimation(e),e.draw(),i}),[]),layers:i,cameraFrame:r,setCameraFrame:a}}function u(e){return(0,s.useMemo)((()=>new d.A(e)),[])}function f(e){let{deckRef:t,mapRef:i,deckAnimation:n,initialViewState:r}=e;const a=(0,s.useMemo)((()=>t.current),[t.current]),o=p(),{adapter:l,layers:h,cameraFrame:c,setCameraFrame:d}=m(n,r),u=(0,s.useCallback)((()=>{if(i){const e=i.current.getMap();e.on("render",(()=>l.onAfterRender(o,e.areTilesLoaded())))}}),[l,o]);return i?{adapter:l,cameraFrame:c,setCameraFrame:d,onMapLoad:u,mapProps:{onLoad:u,preventStyleDiffing:!0},deckProps:l.getProps({deck:a,extraProps:{layers:h}})}:{adapter:l,cameraFrame:c,setCameraFrame:d,mapProps:{},deckProps:l.getProps({deck:a,onNextFrame:o,extraProps:{layers:h}})}}}}]);