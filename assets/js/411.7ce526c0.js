"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[411],{5792:(t,e,s)=>{s.d(e,{A:()=>zs});var i=s(1660),n=s(8411),o=s(6820),r=s(5489),a=s(9464),l=s(2943),h=s(3656),c=s(2170),u=s(1749),d=s(8750),p=s(7585),m=s(7325),g=s(8404),f=s(7870),y=s(1597);const x=Math.PI/180,A=new Float32Array(16),v=new Float32Array(12);function b(t,e,s){const i=e[0]*x,n=e[1]*x,o=e[2]*x,r=Math.sin(o),a=Math.sin(i),l=Math.sin(n),h=Math.cos(o),c=Math.cos(i),u=Math.cos(n),d=s[0],p=s[1],m=s[2];t[0]=d*u*c,t[1]=d*l*c,t[2]=d*-a,t[3]=p*(-l*h+u*a*r),t[4]=p*(u*h+l*a*r),t[5]=p*c*r,t[6]=m*(l*r+u*a*h),t[7]=m*(-u*r+l*a*h),t[8]=m*c*h}function M(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}const _={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrix__LOCATION_0:{size:3,elementOffset:0},instanceModelMatrix__LOCATION_1:{size:3,elementOffset:3},instanceModelMatrix__LOCATION_2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:s}){const{data:i,getOrientation:n,getScale:o,getTranslation:r,getTransformMatrix:a}=this.props,l=Array.isArray(a),h=l&&16===a.length,c=Array.isArray(o),u=Array.isArray(n),d=Array.isArray(r),p=h||!l&&Boolean(a(i[0]));t.constant=p?h:u&&c&&d;const m=t.value;if(t.constant){let e;if(p)A.set(a),e=M(A);else{e=v;b(e,n,o),e.set(r,9)}t.value=new Float32Array(e)}else{let l=e*t.size;const{iterable:g,objectInfo:y}=(0,f.X)(i,e,s);for(const t of g){let e;if(y.index++,p)A.set(h?a:a(t,y)),e=M(A);else{e=v;b(e,u?n:n(t,y),c?o:o(t,y)),e.set(d?r:r(t,y),9)}m[l++]=e[0],m[l++]=e[1],m[l++]=e[2],m[l++]=e[3],m[l++]=e[4],m[l++]=e[5],m[l++]=e[6],m[l++]=e[7],m[l++]=e[8],m[l++]=e[9],m[l++]=e[10],m[l++]=e[11]}}}};function w(t,e){return e===y.rf.CARTESIAN||e===y.rf.METER_OFFSETS||e===y.rf.DEFAULT&&!t.isGeospatial}function S(t,e){(t.COLOR_0||t.colors)&&e||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),o.A.assert(t.positions||t.POSITION,'no "postions" or "POSITION" attribute in mesh')}function T(t,e){if(t.attributes)return S(t.attributes,e),t instanceof c.A?t:new c.A(t);if(t.positions||t.POSITION)return S(t,e),new c.A({attributes:t});throw Error("Invalid mesh")}const C={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_useMeshColors:{type:"boolean",value:!1},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0}};class P extends r.A{constructor(...t){super(...t),(0,i.A)(this,"state",void 0)}getShaders(){const t=!(0,u.C6)(this.context.gl),e={};return(0,m.jI)(this.context.gl,g.G.GLSL_DERIVATIVES)&&(e.DERIVATIVES_AVAILABLE=1),super.getShaders({vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec3 instancePositions;\nin vec3 instancePositions64Low;\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\nin vec3 instanceTranslation;\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = texCoords;\n  geometry.pickingColor = instancePickingColors;\n\n  vTexCoord = texCoords;\n  cameraPosition = project_uCameraPosition;\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale + instanceTranslation;\n\n  if (composeModelMatrix) {\n    DECKGL_FILTER_SIZE(pos, geometry);\n    normals_commonspace = project_normal(instanceModelMatrix * normals);\n    geometry.worldPosition += pos;\n    gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);\n    geometry.position = position_commonspace;\n  }\n  else {\n    pos = project_size(pos);\n    DECKGL_FILTER_SIZE(pos, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);\n    geometry.position = position_commonspace;\n    normals_commonspace = project_normal(instanceModelMatrix * normals);\n  }\n\n  geometry.normal = normals_commonspace;\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  DECKGL_FILTER_COLOR(color, geometry);\n\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n}\n",modules:[a.A,l.p,h.A],transpileToGLSL100:t,defines:e})}getBounds(){var t;if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:s}=this.props;if(!s)return null;if(e=null===(t=s.header)||void 0===t?void 0:t.boundingBox,!e){const{attributes:t}=T(s,this.props._useMeshColors);t.POSITION=t.POSITION||t.positions,e=function(t){let e=1/0,s=1/0,i=1/0,n=-1/0,o=-1/0,r=-1/0;const a=t.POSITION?t.POSITION.value:[],l=a&&a.length;for(let h=0;h<l;h+=3){const t=a[h],l=a[h+1],c=a[h+2];e=t<e?t:e,s=l<s?l:s,i=c<i?c:i,n=t>n?t:n,o=l>o?l:o,r=c>r?c:r}return[[e,s,i],[n,o,r]]}(t)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:5130,fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:5121,transition:!0,size:this.props.colorFormat.length,normalized:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:_}),this.setState({emptyTexture:new d.A(this.context.gl,{data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:e,oldProps:s,changeFlags:i}=t;if(e.mesh!==s.mesh||i.extensionsChanged){var n;if(this.state.positionBounds=null,null===(n=this.state.model)||void 0===n||n.delete(),e.mesh){this.state.model=this.getModel(e.mesh);const t=e.mesh.attributes||e.mesh;this.setState({hasNormals:Boolean(t.NORMAL||t.normals)})}this.getAttributeManager().invalidateAll()}e.texture!==s.texture&&this.setTexture(e.texture),this.state.model&&this.state.model.setDrawMode(this.props.wireframe?3:4)}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw({uniforms:t}){if(!this.state.model)return;const{viewport:e}=this.context,{sizeScale:s,coordinateSystem:i,_instanced:n}=this.props;this.state.model.setUniforms(t).setUniforms({sizeScale:s,composeModelMatrix:!n||w(e,i),flatShading:!this.state.hasNormals}).draw()}get isLoaded(){var t;return(null===(t=this.state)||void 0===t?void 0:t.model)&&super.isLoaded}getModel(t){const e=new p.A(this.context.gl,{...this.getShaders(),id:this.props.id,geometry:T(t,this.props._useMeshColors),isInstanced:!0}),{texture:s}=this.props,{emptyTexture:i}=this.state;return e.setUniforms({sampler:s||i,hasTexture:Boolean(s)}),e}setTexture(t){const{emptyTexture:e,model:s}=this.state;s&&s.setUniforms({sampler:t||e,hasTexture:Boolean(t)})}}(0,i.A)(P,"defaultProps",C),(0,i.A)(P,"layerName","SimpleMeshLayer");const L={name:"Terrain",id:"terrain",module:"terrain",version:"3.4.15",worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:null,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:null}}};var z=s(3716),I=s(3986);var R=s(6090),O=s(6510),E=s(9510),k=s(8469),q=s(8086);const N={circle:{type:O.A,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:R.A,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:E.A,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},B={type:k.A,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},D={type:q.A,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function F({type:t,props:e}){const s={};for(const i in e)s[i]=t.defaultProps[e[i]];return s}function j(t,e){const{transitions:s,updateTriggers:i}=t.props,n={updateTriggers:{},transitions:s&&{getPosition:s.geometry}};for(const o in e){const r=e[o];let a=t.props[o];o.startsWith("get")&&(a=t.getSubLayerAccessor(a),n.updateTriggers[r]=i[o],s&&(n.transitions[r]=s[o])),n[r]=a}return n}function V(t,e,s={}){const i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:r=t.length}=s;for(let a=n;a<r;a++){const s=t[a],{geometry:n}=s;if(n)if("GeometryCollection"===n.type){o.A.assert(Array.isArray(n.geometries),"GeoJSON does not have geometries array");const{geometries:t}=n;for(let n=0;n<t.length;n++){W(t[n],i,e,s,a)}}else W(n,i,e,s,a)}return i}function W(t,e,s,i,n){const{type:r,coordinates:a}=t,{pointFeatures:l,lineFeatures:h,polygonFeatures:c,polygonOutlineFeatures:u}=e;if(function(t,e){let s=Z[t];o.A.assert(s,"Unknown GeoJSON type ".concat(t));for(;e&&--s>0;)e=e[0];return e&&Number.isFinite(e[0])}(r,a))switch(r){case"Point":l.push(s({geometry:t},i,n));break;case"MultiPoint":a.forEach((t=>{l.push(s({geometry:{type:"Point",coordinates:t}},i,n))}));break;case"LineString":h.push(s({geometry:t},i,n));break;case"MultiLineString":a.forEach((t=>{h.push(s({geometry:{type:"LineString",coordinates:t}},i,n))}));break;case"Polygon":c.push(s({geometry:t},i,n)),a.forEach((t=>{u.push(s({geometry:{type:"LineString",coordinates:t}},i,n))}));break;case"MultiPolygon":a.forEach((t=>{c.push(s({geometry:{type:"Polygon",coordinates:t}},i,n)),t.forEach((t=>{u.push(s({geometry:{type:"LineString",coordinates:t}},i,n))}))}))}else o.A.warn("".concat(r," coordinates are malformed"))()}const Z={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function U(t){return t.geometry.coordinates}function G(t,e){const s={points:{},lines:{},polygons:{},polygonsOutline:{}},{points:i,lines:n,polygons:o}=t,r=function(t,e){const s={points:null,lines:null,polygons:null};for(const i in s){const n=t[i].globalFeatureIds.value;s[i]=new Uint8ClampedArray(3*n.length);const o=[];for(let t=0;t<n.length;t++)e(n[t],o),s[i][3*t+0]=o[0],s[i][3*t+1]=o[1],s[i][3*t+2]=o[2]}return s}(t,e);return s.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:3,value:r.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},s.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:3,value:r.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},s.lines._pathType="open",s.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:{...o.attributes,getPolygon:o.positions,pickingColors:{size:3,value:r.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},s.polygons._normalize=!1,o.triangles&&(s.polygons.data.attributes.indices=o.triangles.value),s.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:{...o.attributes,getPath:o.positions,instancePickingColors:{size:3,value:r.polygons}},properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},s.polygonsOutline._pathType="open",s}const K=["points","linestrings","polygons"],H={...F(N.circle),...F(N.icon),...F(N.text),...F(B),...F(D),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Q extends n.A{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:t,changeFlags:e}){if(!e.dataChanged)return;const{data:s}=this.props,i=s&&"points"in s&&"polygons"in s&&"lines"in s;this.setState({binary:i}),i?this._updateStateBinary({props:t,changeFlags:e}):this._updateStateJSON({props:t,changeFlags:e})}_updateStateBinary({props:t,changeFlags:e}){const s=G(t.data,this.encodePickingColor);this.setState({layerProps:s})}_updateStateJSON({props:t,changeFlags:e}){const s=function(t){if(Array.isArray(t))return t;switch(o.A.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return o.A.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}(t.data),i=this.getSubLayerRow.bind(this);let n={};const r={};if(Array.isArray(e.dataChanged)){const t=this.state.features;for(const e in t)n[e]=t[e].slice(),r[e]=[];for(const o of e.dataChanged){const e=V(s,i,o);for(const s in t)r[s].push((0,I.J)({data:n[s],getIndex:t=>t.__source.index,dataRange:o,replace:e[s]}))}}else n=V(s,i);const a=function(t,e){const s={points:{},lines:{},polygons:{},polygonsOutline:{}},{pointFeatures:i,lineFeatures:n,polygonFeatures:o,polygonOutlineFeatures:r}=t;return s.points.data=i,s.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),s.points.getPosition=U,s.lines.data=n,s.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),s.lines.getPath=U,s.polygons.data=o,s.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),s.polygons.getPolygon=U,s.polygonsOutline.data=r,s.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),s.polygonsOutline.getPath=U,s}(n,r);this.setState({features:n,featuresDiff:r,layerProps:a})}getPickingInfo(t){const e=super.getPickingInfo(t),{index:s,sourceLayer:i}=e;return e.featureType=K.find((t=>i.id.startsWith("".concat(this.id,"-").concat(t,"-")))),s>=0&&i.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(e.index=this.props.data.points.globalFeatureIds.value[s]),e}_updateAutoHighlight(t){const e="".concat(this.id,"-points-"),s="points"===t.featureType;for(const i of this.getSubLayers())i.id.startsWith(e)===s&&i.updateAutoHighlight(t)}_renderPolygonLayer(){const{extruded:t,wireframe:e}=this.props,{layerProps:s}=this.state,i="polygons-fill",n=this.shouldRenderSubLayer(i,s.polygons.data)&&this.getSubLayerClass(i,D.type);if(n){const o=j(this,D.props),r=t&&e;return r||delete o.getLineColor,o.updateTriggers.lineColors=r,new n(o,this.getSubLayerProps({id:i,updateTriggers:o.updateTriggers}),s.polygons)}return null}_renderLineLayers(){const{extruded:t,stroked:e}=this.props,{layerProps:s}=this.state,i="polygons-stroke",n="linestrings",o=!t&&e&&this.shouldRenderSubLayer(i,s.polygonsOutline.data)&&this.getSubLayerClass(i,B.type),r=this.shouldRenderSubLayer(n,s.lines.data)&&this.getSubLayerClass(n,B.type);if(o||r){const t=j(this,B.props);return[o&&new o(t,this.getSubLayerProps({id:i,updateTriggers:t.updateTriggers}),s.polygonsOutline),r&&new r(t,this.getSubLayerProps({id:n,updateTriggers:t.updateTriggers}),s.lines)]}return null}_renderPointLayers(){const{pointType:t}=this.props,{layerProps:e,binary:s}=this.state;let{highlightedObjectIndex:i}=this.props;!s&&Number.isFinite(i)&&(i=e.points.data.findIndex((t=>t.__source.index===i)));const n=new Set(t.split("+")),o=[];for(const r of n){const t="points-".concat(r),n=N[r],a=n&&this.shouldRenderSubLayer(t,e.points.data)&&this.getSubLayerClass(t,n.type);if(a){const l=j(this,n.props);let h=e.points;if("text"===r&&s){const{instancePickingColors:t,...e}=h.data.attributes;h={...h,data:{...h.data,attributes:e}}}o.push(new a(l,this.getSubLayerProps({id:t,updateTriggers:l.updateTriggers,highlightedObjectIndex:i}),h))}}return o}renderLayers(){const{extruded:t}=this.props,e=this._renderPolygonLayer();return[!t&&e,this._renderLineLayers(),this._renderPointLayers(),t&&e]}getSubLayerAccessor(t){const{binary:e}=this.state;return e&&"function"==typeof t?(e,s)=>{const{data:i,index:n}=s,o=function(t,e){if(!t)return null;const s="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[s];return-1!==s?function(t,e,s){const i={properties:{...t.properties[e]}};for(const n in t.numericProps)i.properties[n]=t.numericProps[n].value[s];return i}(t,i,s):null}(i,n);return t(o,s)}:super.getSubLayerAccessor(t)}}(0,i.A)(Q,"layerName","GeoJsonLayer"),(0,i.A)(Q,"defaultProps",H);var J=s(7505);const X={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Y{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.A)(this,"props",void 0),(0,i.A)(this,"stats",void 0),(0,i.A)(this,"activeRequestCount",0),(0,i.A)(this,"requestQueue",[]),(0,i.A)(this,"requestMap",new Map),(0,i.A)(this,"deferredUpdate",null),this.props={...X,...t},this.stats=new J.A({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const s={handle:t,priority:0,getPriority:e},i=new Promise((t=>(s.resolve=t,s)));return this.requestQueue.push(s),this.requestMap.set(t,i),this._issueNewRequests(),i}_issueRequest(t){const{handle:e,resolve:s}=t;let i=!1;const n=()=>{i||(i=!0,this.requestMap.delete(e),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:n}):Promise.resolve({done:n})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout((()=>this._issueNewRequestsAsync()),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(let e=0;e<t;++e){const t=this.requestQueue.shift();t&&this._issueRequest(t)}}}_updateAllRequests(){const t=this.requestQueue;for(let e=0;e<t.length;++e){const s=t[e];this._updateRequest(s)||(t.splice(e,1),this.requestMap.delete(s.handle),e--)}t.sort(((t,e)=>t.priority-e.priority))}_updateRequest(t){return t.priority=t.getPriority(t.handle),!(t.priority<0)||(t.resolve(null),!1)}}var $=s(8569),tt=s(4692);class et{constructor(t){(0,i.A)(this,"index",void 0),(0,i.A)(this,"isVisible",void 0),(0,i.A)(this,"isSelected",void 0),(0,i.A)(this,"parent",void 0),(0,i.A)(this,"children",void 0),(0,i.A)(this,"content",void 0),(0,i.A)(this,"state",void 0),(0,i.A)(this,"layers",void 0),(0,i.A)(this,"id",void 0),(0,i.A)(this,"zoom",void 0),(0,i.A)(this,"userData",void 0),(0,i.A)(this,"boundingBox",void 0),(0,i.A)(this,"_abortController",void 0),(0,i.A)(this,"_loader",void 0),(0,i.A)(this,"_loaderId",void 0),(0,i.A)(this,"_isLoaded",void 0),(0,i.A)(this,"_isCancelled",void 0),(0,i.A)(this,"_needsReload",void 0),(0,i.A)(this,"_bbox",void 0),this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(t){this._bbox||(this._bbox=t,this.boundingBox="west"in t?[[t.west,t.south],[t.east,t.north]]:[[t.left,t.top],[t.right,t.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then((()=>this.data)):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const t=this.content?this.content.byteLength:0;return Number.isFinite(t)||console.error("byteLength not defined in tile data"),t}async _loadData({getData:t,requestScheduler:e,onLoad:s,onError:i}){const{index:n,id:o,bbox:r,userData:a,zoom:l}=this,h=this._loaderId;this._abortController=new AbortController;const{signal:c}=this._abortController,u=await e.scheduleRequest(this,(t=>t.isSelected?1:-1));if(!u)return void(this._isCancelled=!0);if(this._isCancelled)return void u.done();let d,p=null;try{p=await t({index:n,id:o,bbox:r,userData:a,zoom:l,signal:c})}catch(m){d=m||!0}finally{u.done()}h===this._loaderId&&(this._loader=void 0,this.content=p,!this._isCancelled||p?(this._isLoaded=!0,this._isCancelled=!1,d?i(d,this):s(this)):this._isLoaded=!1)}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var t;this.isLoaded||(this._isCancelled=!0,null===(t=this._abortController)||void 0===t||t.abort())}}var st=s(4684),it=s(329),nt=s(4796);const ot=Math.PI/180,rt=180/Math.PI,at=6370972,lt=256;function ht(){const t=4018225162502676e-20,e=Math.PI/180*lt;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,24886.609375]}}class ct extends st.A{constructor(t={}){const{latitude:e=0,longitude:s=0,zoom:n=0,nearZMultiplier:o=.1,farZMultiplier:r=2,resolution:a=10}=t;let{height:l,altitude:h=1.5}=t;l=l||1,h=Math.max(.75,h);const c=(new $.A).lookAt({eye:[0,-h,0],up:[0,0,1]}),u=Math.pow(2,n);c.rotateX(e*ot),c.rotateZ(-s*ot),c.scale(u/l);const d=Math.atan(.5/h),p=512*u/l;super({...t,height:l,viewMatrix:c,longitude:s,latitude:e,zoom:n,distanceScales:ht(),fovyRadians:2*d,focalDistance:h,near:o,far:Math.min(2,1/p+1)*h*r}),(0,i.A)(this,"longitude",void 0),(0,i.A)(this,"latitude",void 0),(0,i.A)(this,"resolution",void 0),this.latitude=e,this.longitude=s,this.resolution=a}get projectionMode(){return y.Kx.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const e={targetZ:t.z||0},s=this.unproject([0,this.height/2],e),i=this.unproject([this.width/2,0],e),n=this.unproject([this.width,this.height/2],e),o=this.unproject([this.width/2,this.height],e);return n[0]<this.longitude&&(n[0]+=360),s[0]>this.longitude&&(s[0]-=360),[Math.min(s[0],n[0],i[0],o[0]),Math.min(s[1],n[1],i[1],o[1]),Math.max(s[0],n[0],i[0],o[0]),Math.max(s[1],n[1],i[1],o[1])]}unproject(t,{topLeft:e=!0,targetZ:s}={}){const[i,n,o]=t,r=e?n:this.height-n,{pixelUnprojectionMatrix:a}=this;let l;if(Number.isFinite(o))l=ut(a,[i,r,o,1]);else{const t=ut(a,[i,r,-1,1]),e=ut(a,[i,r,1,1]),n=((s||0)/at+1)*lt,o=it.uE(it.jb([],t,e)),h=it.uE(t),c=it.uE(e),u=4*((4*h*c-(o-h-c)**2)/16)/o,d=(Math.sqrt(h-u)-Math.sqrt(Math.max(0,n*n-u)))/Math.sqrt(o);l=it.Cc([],t,e,d)}const[h,c,u]=this.unprojectPosition(l);return Number.isFinite(o)?[h,c,u]:Number.isFinite(s)?[h,c,s]:[h,c]}projectPosition(t){const[e,s,i=0]=t,n=e*ot,o=s*ot,r=Math.cos(o),a=(i/at+1)*lt;return[Math.sin(n)*r*a,-Math.cos(n)*r*a,Math.sin(o)*a]}unprojectPosition(t){const[e,s,i]=t,n=it.Il(t),o=Math.asin(i/n);return[Math.atan2(e,-s)*rt,o*rt,(n/lt-1)*at]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,e){const s=this.unproject(e);return{longitude:t[0]-s[0]+this.longitude,latitude:t[1]-s[1]+this.latitude}}}function ut(t,e){const s=nt.Z0([],e,t);return nt.hs(s,s,1/s[3]),s}var dt=s(2125);const pt=-1,mt=0,gt=1;var ft=s(2466);const yt=new ft.A,xt=new ft.A;class At{constructor(t=[0,0,0],e=[0,0,0],s){(0,i.A)(this,"center",void 0),(0,i.A)(this,"halfDiagonal",void 0),(0,i.A)(this,"minimum",void 0),(0,i.A)(this,"maximum",void 0),s=s||yt.copy(t).add(e).scale(.5),this.center=new ft.A(s),this.halfDiagonal=new ft.A(e).subtract(this.center),this.minimum=new ft.A(t),this.maximum=new ft.A(e)}clone(){return new At(this.minimum,this.maximum,this.center)}equals(t){return this===t||Boolean(t)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:e}=this,s=xt.from(t.normal),i=e.x*Math.abs(s.x)+e.y*Math.abs(s.y)+e.z*Math.abs(s.z),n=this.center.dot(s)+t.distance;return n-i>0?gt:n+i<0?pt:mt}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=yt.from(t).subtract(this.center),{halfDiagonal:s}=this;let i,n=0;return i=Math.abs(e.x)-s.x,i>0&&(n+=i*i),i=Math.abs(e.y)-s.y,i>0&&(n+=i*i),i=Math.abs(e.z)-s.z,i>0&&(n+=i*i),n}}var vt=s(7684);const bt=new ft.A,Mt=new ft.A;class _t{constructor(t=[0,0,0],e=0){(0,i.A)(this,"center",void 0),(0,i.A)(this,"radius",void 0),this.radius=-0,this.center=new ft.A,this.fromCenterRadius(t,e)}fromCenterRadius(t,e){return this.center.from(t),this.radius=e,this}fromCornerPoints(t,e){return e=bt.from(e),this.center=(new ft.A).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new _t(this.center,this.radius)}union(t){const e=this.center,s=this.radius,i=t.center,n=t.radius,o=bt.copy(i).subtract(e),r=o.magnitude();if(s>=r+n)return this.clone();if(n>=r+s)return t.clone();const a=.5*(s+r+n);return Mt.copy(o).scale((-s+a)/r).add(e),this.center.copy(Mt),this.radius=a,this}expand(t){const e=bt.from(t).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}transform(t){this.center.transform(t);const e=vt.IL(bt,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}distanceSquaredTo(t){const e=this.distanceTo(t);return e*e}distanceTo(t){const e=bt.from(t).subtract(this.center);return Math.max(0,e.len()-this.radius)}intersectPlane(t){const e=this.center,s=this.radius,i=t.normal.dot(e)+t.distance;return i<-s?pt:i<s?mt:gt}}var wt=s(2129),St=s(4273),Tt=s(2760),Ct=s(7823);function Pt(t,e,s){var i=e[0],n=e[1],o=e[2],r=e[3],a=e[4],l=e[5],h=e[6],c=e[7],u=e[8],d=s[0],p=s[1],m=s[2],g=s[3],f=s[4],y=s[5],x=s[6],A=s[7],v=s[8];return t[0]=d*i+p*r+m*h,t[1]=d*n+p*a+m*c,t[2]=d*o+p*l+m*u,t[3]=g*i+f*r+y*h,t[4]=g*n+f*a+y*c,t[5]=g*o+f*l+y*u,t[6]=x*i+A*r+v*h,t[7]=x*n+A*a+v*c,t[8]=x*o+A*l+v*u,t}function Lt(t,e,s){var i=s[0],n=s[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}var zt,It=s(842);!function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"}(zt||(zt={}));const Rt=Object.freeze([1,0,0,0,1,0,0,0,1]);class Ot extends wt.A{static get IDENTITY(){return function(){kt||(kt=new Ot,Object.freeze(kt));return kt}()}static get ZERO(){return function(){Et||(Et=new Ot([0,0,0,0,0,0,0,0,0]),Object.freeze(Et));return Et}()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return zt}constructor(t,...e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):e.length>0?this.copy([t,...e]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(Rt)}fromObject(t){return this.check()}fromQuaternion(t){return function(t,e){var s=e[0],i=e[1],n=e[2],o=e[3],r=s+s,a=i+i,l=n+n,h=s*r,c=i*r,u=i*a,d=n*r,p=n*a,m=n*l,g=o*r,f=o*a,y=o*l;t[0]=1-u-m,t[3]=c-y,t[6]=d+f,t[1]=c+y,t[4]=1-h-m,t[7]=p-g,t[2]=d-f,t[5]=p+g,t[8]=1-h-u}(this,t),this.check()}set(t,e,s,i,n,o,r,a,l){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this[4]=n,this[5]=o,this[6]=r,this[7]=a,this[8]=l,this.check()}setRowMajor(t,e,s,i,n,o,r,a,l){return this[0]=t,this[1]=i,this[2]=r,this[3]=e,this[4]=n,this[5]=a,this[6]=s,this[7]=o,this[8]=l,this.check()}determinant(){return e=(t=this)[0],s=t[1],i=t[2],n=t[3],o=t[4],r=t[5],a=t[6],l=t[7],h=t[8],e*(h*o-r*l)+s*(-h*n+r*a)+i*(l*n-o*a);var t,e,s,i,n,o,r,a,l,h}transpose(){return function(t,e){if(t===e){var s=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=s,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}invert(){var t,e,s,i,n,o,r,a,l,h,c,u,d,p,m;return t=this,s=(e=this)[0],i=e[1],n=e[2],o=e[3],r=e[4],a=e[5],l=e[6],h=e[7],c=e[8],(m=s*(u=c*r-a*h)+i*(d=-c*o+a*l)+n*(p=h*o-r*l))&&(m=1/m,t[0]=u*m,t[1]=(-c*i+n*h)*m,t[2]=(a*i-n*r)*m,t[3]=d*m,t[4]=(c*s-n*l)*m,t[5]=(-a*s+n*o)*m,t[6]=p*m,t[7]=(-h*s+i*l)*m,t[8]=(r*s-i*o)*m),this.check()}multiplyLeft(t){return Pt(this,t,this),this.check()}multiplyRight(t){return Pt(this,this,t),this.check()}rotate(t){var e,s,i,n,o,r,a,l,h,c,u,d,p,m;return e=this,i=t,n=(s=this)[0],o=s[1],r=s[2],a=s[3],l=s[4],h=s[5],c=s[6],u=s[7],d=s[8],p=Math.sin(i),m=Math.cos(i),e[0]=m*n+p*a,e[1]=m*o+p*l,e[2]=m*r+p*h,e[3]=m*a-p*n,e[4]=m*l-p*o,e[5]=m*h-p*r,e[6]=c,e[7]=u,e[8]=d,this.check()}scale(t){return Array.isArray(t)?Lt(this,this,t):Lt(this,this,[t,t]),this.check()}translate(t){var e,s,i,n,o,r,a,l,h,c,u,d,p,m;return e=this,i=t,n=(s=this)[0],o=s[1],r=s[2],a=s[3],l=s[4],h=s[5],c=s[6],u=s[7],d=s[8],p=i[0],m=i[1],e[0]=n,e[1]=o,e[2]=r,e[3]=a,e[4]=l,e[5]=h,e[6]=p*n+m*a+c,e[7]=p*o+m*l+u,e[8]=p*r+m*h+d,this.check()}transform(t,e){let s;switch(t.length){case 2:s=It.ei(e||[-0,-0],t,this);break;case 3:s=it.ei(e||[-0,-0,-0],t,this);break;case 4:s=(0,Tt.vE)(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return(0,St.qk)(s,t.length),s}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let Et,kt;var qt=s(6094),Nt=s(7295);let Bt;class Dt extends Nt.A{static get ZERO(){return Bt||(Bt=new Dt(0,0,0,0),Object.freeze(Bt)),Bt}constructor(t=0,e=0,s=0,i=0){super(-0,-0,-0,-0),(0,tt.cy)(t)&&1===arguments.length?this.copy(t):(tt.$W.debug&&((0,St.ws)(t),(0,St.ws)(e),(0,St.ws)(s),(0,St.ws)(i)),this[0]=t,this[1]=e,this[2]=s,this[3]=i)}set(t,e,s,i){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return tt.$W.debug&&((0,St.ws)(t.x),(0,St.ws)(t.y),(0,St.ws)(t.z),(0,St.ws)(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=(0,St.ws)(t)}get w(){return this[3]}set w(t){this[3]=(0,St.ws)(t)}transform(t){return it.Z0(this,this,t),this.check()}transformByMatrix3(t){return(0,Tt.vE)(this,this,t),this.check()}transformByMatrix2(t){return(0,Tt.Cg)(this,this,t),this.check()}transformByQuaternion(t){return it.gL(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}function Ft(){var t=new Ct.tb(4);return Ct.tb!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function jt(t,e,s){s*=.5;var i=Math.sin(s);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(s),t}function Vt(t,e,s){var i=e[0],n=e[1],o=e[2],r=e[3],a=s[0],l=s[1],h=s[2],c=s[3];return t[0]=i*c+r*a+n*h-o*l,t[1]=n*c+r*l+o*a-i*h,t[2]=o*c+r*h+i*l-n*a,t[3]=r*c-i*a-n*l-o*h,t}function Wt(t,e,s,i){var n,o,r,a,l,h=e[0],c=e[1],u=e[2],d=e[3],p=s[0],m=s[1],g=s[2],f=s[3];return(o=h*p+c*m+u*g+d*f)<0&&(o=-o,p=-p,m=-m,g=-g,f=-f),1-o>Ct.p8?(n=Math.acos(o),r=Math.sin(n),a=Math.sin((1-i)*n)/r,l=Math.sin(i*n)/r):(a=1-i,l=i),t[0]=a*h+l*p,t[1]=a*c+l*m,t[2]=a*u+l*g,t[3]=a*d+l*f,t}function Zt(t,e){var s,i=e[0]+e[4]+e[8];if(i>0)s=Math.sqrt(i+1),t[3]=.5*s,s=.5/s,t[0]=(e[5]-e[7])*s,t[1]=(e[6]-e[2])*s,t[2]=(e[1]-e[3])*s;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var o=(n+1)%3,r=(n+2)%3;s=Math.sqrt(e[3*n+n]-e[3*o+o]-e[3*r+r]+1),t[n]=.5*s,s=.5/s,t[3]=(e[3*o+r]-e[3*r+o])*s,t[o]=(e[3*o+n]+e[3*n+o])*s,t[r]=(e[3*r+n]+e[3*n+r])*s}return t}nt.o8,nt.fA,nt.C,nt.hZ;var Ut,Gt,Kt,Ht,Qt,Jt,Xt,Yt=nt.WQ,$t=nt.hs,te=nt.Om,ee=nt.Cc,se=nt.Bw,ie=nt.m3,ne=nt.S8,oe=(nt.t2,nt.aI,Ut=it.vt(),Gt=it.fA(1,0,0),Kt=it.fA(0,1,0),function(t,e,s){var i=it.Om(e,s);return i<-.999999?(it.$A(Ut,Gt,e),it.Il(Ut)<1e-6&&it.$A(Ut,Kt,e),it.S8(Ut,Ut),jt(t,Ut,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(it.$A(Ut,e,s),t[0]=Ut[0],t[1]=Ut[1],t[2]=Ut[2],t[3]=1+i,ne(t,t))});Ht=Ft(),Qt=Ft(),Jt=new Ct.tb(9),Ct.tb!=Float32Array&&(Jt[1]=0,Jt[2]=0,Jt[3]=0,Jt[5]=0,Jt[6]=0,Jt[7]=0),Jt[0]=1,Jt[4]=1,Jt[8]=1,Xt=Jt;const re=[0,0,0,1];class ae extends qt.A{constructor(t=0,e=0,s=0,i=1){super(-0,-0,-0,-0),Array.isArray(t)&&1===arguments.length?this.copy(t):this.set(t,e,s,i)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,e,s,i){return this[0]=t,this[1]=e,this[2]=s,this[3]=i,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return Zt(this,t),this.check()}fromAxisRotation(t,e){return jt(this,t,e),this.check()}identity(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}setAxisAngle(t,e){return this.fromAxisRotation(t,e)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=(0,St.ws)(t)}get y(){return this[1]}set y(t){this[1]=(0,St.ws)(t)}get z(){return this[2]}set z(t){this[2]=(0,St.ws)(t)}get w(){return this[3]}set w(t){this[3]=(0,St.ws)(t)}len(){return se(this)}lengthSquared(){return ie(this)}dot(t){return te(this,t)}rotationTo(t,e){return oe(this,t,e),this.check()}add(t){return Yt(this,this,t),this.check()}calculateW(){return function(t,e){var s=e[0],i=e[1],n=e[2];t[0]=s,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-s*s-i*i-n*n))}(this,this),this.check()}conjugate(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}invert(){return function(t,e){var s=e[0],i=e[1],n=e[2],o=e[3],r=s*s+i*i+n*n+o*o,a=r?1/r:0;t[0]=-s*a,t[1]=-i*a,t[2]=-n*a,t[3]=o*a}(this,this),this.check()}lerp(t,e,s){return void 0===s?this.lerp(this,t,e):(ee(this,t,e,s),this.check())}multiplyRight(t){return Vt(this,this,t),this.check()}multiplyLeft(t){return Vt(this,t,this),this.check()}normalize(){const t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}rotateX(t){return function(t,e,s){s*=.5;var i=e[0],n=e[1],o=e[2],r=e[3],a=Math.sin(s),l=Math.cos(s);t[0]=i*l+r*a,t[1]=n*l+o*a,t[2]=o*l-n*a,t[3]=r*l-i*a}(this,this,t),this.check()}rotateY(t){return function(t,e,s){s*=.5;var i=e[0],n=e[1],o=e[2],r=e[3],a=Math.sin(s),l=Math.cos(s);t[0]=i*l-o*a,t[1]=n*l+r*a,t[2]=o*l+i*a,t[3]=r*l-n*a}(this,this,t),this.check()}rotateZ(t){return function(t,e,s){s*=.5;var i=e[0],n=e[1],o=e[2],r=e[3],a=Math.sin(s),l=Math.cos(s);t[0]=i*l+n*a,t[1]=n*l-i*a,t[2]=o*l+r*a,t[3]=r*l-o*a}(this,this,t),this.check()}scale(t){return $t(this,this,t),this.check()}slerp(t,e,s){let i,n,o;switch(arguments.length){case 1:({start:i=re,target:n,ratio:o}=t);break;case 2:i=this,n=t,o=e;break;default:i=t,n=e,o=s}return Wt(this,i,n,o),this.check()}transformVector4(t,e=new Dt){return nt.gL(e,t,this),(0,St.qk)(e,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,e){return this.setAxisAngle(t,e)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const le=new ft.A,he=new ft.A,ce=new ft.A,ue=new ft.A,de=new ft.A,pe=new ft.A,me=new ft.A,ge=0,fe=1,ye=2,xe=3,Ae=4,ve=5,be=6,Me=7,_e=8;class we{constructor(t=[0,0,0],e=[0,0,0,0,0,0,0,0,0]){(0,i.A)(this,"center",void 0),(0,i.A)(this,"halfAxes",void 0),this.center=(new ft.A).from(t),this.halfAxes=new Ot(e)}get halfSize(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new ft.A(t).len(),new ft.A(e).len(),new ft.A(s).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),i=new ft.A(t).normalize(),n=new ft.A(e).normalize(),o=new ft.A(s).normalize();return(new ae).fromMatrix3(new Ot([...i,...n,...o]))}fromCenterHalfSizeQuaternion(t,e,s){const i=new ae(s),n=(new Ot).fromQuaternion(i);return n[0]=n[0]*e[0],n[1]=n[1]*e[0],n[2]=n[2]*e[0],n[3]=n[3]*e[1],n[4]=n[4]*e[1],n[5]=n[5]*e[1],n[6]=n[6]*e[2],n[7]=n[7]*e[2],n[8]=n[8]*e[2],this.center=(new ft.A).from(t),this.halfAxes=n,this}clone(){return new we(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new _t){const e=this.halfAxes,s=e.getColumn(0,ce),i=e.getColumn(1,ue),n=e.getColumn(2,de),o=le.copy(s).add(i).add(n);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const e=this.center,s=t.normal,i=this.halfAxes,n=s.x,o=s.y,r=s.z,a=Math.abs(n*i[ge]+o*i[fe]+r*i[ye])+Math.abs(n*i[xe]+o*i[Ae]+r*i[ve])+Math.abs(n*i[be]+o*i[Me]+r*i[_e]),l=s.dot(e)+t.distance;return l<=-a?pt:l>=a?gt:mt}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const e=he.from(t).subtract(this.center),s=this.halfAxes,i=s.getColumn(0,ce),n=s.getColumn(1,ue),o=s.getColumn(2,de),r=i.magnitude(),a=n.magnitude(),l=o.magnitude();i.normalize(),n.normalize(),o.normalize();let h,c=0;return h=Math.abs(e.dot(i))-r,h>0&&(c+=h*h),h=Math.abs(e.dot(n))-a,h>0&&(c+=h*h),h=Math.abs(e.dot(o))-l,h>0&&(c+=h*h),c}computePlaneDistances(t,e,s=[-0,-0]){let i=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;const o=this.center,r=this.halfAxes,a=r.getColumn(0,ce),l=r.getColumn(1,ue),h=r.getColumn(2,de),c=pe.copy(a).add(l).add(h).add(o),u=me.copy(c).subtract(t);let d=e.dot(u);return i=Math.min(d,i),n=Math.max(d,n),c.copy(o).add(a).add(l).subtract(h),u.copy(c).subtract(t),d=e.dot(u),i=Math.min(d,i),n=Math.max(d,n),c.copy(o).add(a).subtract(l).add(h),u.copy(c).subtract(t),d=e.dot(u),i=Math.min(d,i),n=Math.max(d,n),c.copy(o).add(a).subtract(l).subtract(h),u.copy(c).subtract(t),d=e.dot(u),i=Math.min(d,i),n=Math.max(d,n),o.copy(c).subtract(a).add(l).add(h),u.copy(c).subtract(t),d=e.dot(u),i=Math.min(d,i),n=Math.max(d,n),o.copy(c).subtract(a).add(l).subtract(h),u.copy(c).subtract(t),d=e.dot(u),i=Math.min(d,i),n=Math.max(d,n),o.copy(c).subtract(a).subtract(l).add(h),u.copy(c).subtract(t),d=e.dot(u),i=Math.min(d,i),n=Math.max(d,n),o.copy(c).subtract(a).subtract(l).subtract(h),u.copy(c).subtract(t),d=e.dot(u),i=Math.min(d,i),n=Math.max(d,n),s[0]=i,s[1]=n,s}transform(t){this.center.transformAsPoint(t);const e=this.halfAxes.getColumn(0,ce);e.transformAsPoint(t);const s=this.halfAxes.getColumn(1,ue);s.transformAsPoint(t);const i=this.halfAxes.getColumn(2,de);return i.transformAsPoint(t),this.halfAxes=new Ot([...e,...s,...i]),this}getTransform(){throw new Error("not implemented")}}var Se=s(8523);const Te=new ft.A,Ce=new ft.A;class Pe{constructor(t=[0,0,1],e=0){(0,i.A)(this,"normal",void 0),(0,i.A)(this,"distance",void 0),this.normal=new ft.A,this.distance=-0,this.fromNormalDistance(t,e)}fromNormalDistance(t,e){return(0,Se.A)(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}fromPointNormal(t,e){t=Te.from(t),this.normal.from(e).normalize();const s=-this.normal.dot(t);return this.distance=s,this}fromCoefficients(t,e,s,i){return this.normal.set(t,e,s),(0,Se.A)((0,tt.aI)(this.normal.len(),1)),this.distance=i,this}clone(){return new Pe(this.normal,this.distance)}equals(t){return(0,tt.aI)(this.distance,t.distance)&&(0,tt.aI)(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const e=Ce.copy(this.normal).transformAsVector(t).normalize(),s=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(s,e)}projectPointOntoPlane(t,e=[0,0,0]){t=Te.from(t);const s=this.getPointDistance(t),i=Ce.copy(this.normal).scale(s);return t.subtract(i).to(e)}}const Le=[new ft.A([1,0,0]),new ft.A([0,1,0]),new ft.A([0,0,1])],ze=new ft.A,Ie=new ft.A;new Pe(new ft.A(1,0,0),0);class Re{constructor(t=[]){(0,i.A)(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*Le.length;const e=t.center,s=t.radius;let i=0;for(const n of Le){let t=this.planes[i],o=this.planes[i+1];t||(t=this.planes[i]=new Pe),o||(o=this.planes[i+1]=new Pe);const r=ze.copy(n).scale(-s).add(e);n.dot(r);t.fromPointNormal(r,n);const a=ze.copy(n).scale(s).add(e),l=Ie.copy(n).negate();l.dot(a);o.fromPointNormal(a,l),i+=2}return this}computeVisibility(t){let e=gt;for(const s of this.planes){switch(t.intersectPlane(s)){case pt:return pt;case mt:e=mt}}return e}computeVisibilityWithPlaneMask(t,e){if((0,Se.A)(Number.isFinite(e),"parentPlaneMask is required."),e===Re.MASK_OUTSIDE||e===Re.MASK_INSIDE)return e;let s=Re.MASK_INSIDE;const i=this.planes;for(let n=0;n<this.planes.length;++n){const o=n<31?1<<n:0;if(n<31&&!(e&o))continue;const r=i[n],a=t.intersectPlane(r);if(a===pt)return Re.MASK_OUTSIDE;a===mt&&(s|=o)}return s}}(0,i.A)(Re,"MASK_OUTSIDE",4294967295),(0,i.A)(Re,"MASK_INSIDE",0),(0,i.A)(Re,"MASK_INDETERMINATE",2147483647);new ft.A,new ft.A,new ft.A,new ft.A,new ft.A;new ft.A,new ft.A,new ft.A,new ft.A,new ft.A,new ft.A,new ft.A,new ft.A,new ft.A,new ft.A,new ft.A,new ft.A,Math.PI;const Oe=1e-15,Ee=1e-20,ke=(Math.PI,Math.PI,Math.PI,Math.PI,new Ot),qe=new Ot,Ne=new Ot,Be=new Ot,De=new Ot;function Fe(t,e={}){const s=Ee;let i=0,n=0;const o=qe,r=Ne;o.identity(),r.copy(t);const a=s*function(t){let e=0;for(let s=0;s<9;++s){const i=t[s];e+=i*i}return Math.sqrt(e)}(r);for(;n<10&&We(r)>a;)Ze(r,Be),De.copy(Be).transpose(),r.multiplyRight(Be),r.multiplyLeft(De),o.multiplyRight(Be),++i>2&&(++n,i=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=r.toTarget(e.diagonal),e}const je=[1,0,0],Ve=[2,2,1];function We(t){let e=0;for(let s=0;s<3;++s){const i=t[ke.getElementIndex(Ve[s],je[s])];e+=2*i*i}return Math.sqrt(e)}function Ze(t,e){const s=Oe;let i=0,n=1;for(let h=0;h<3;++h){const e=Math.abs(t[ke.getElementIndex(Ve[h],je[h])]);e>i&&(n=h,i=e)}const o=je[n],r=Ve[n];let a=1,l=0;if(Math.abs(t[ke.getElementIndex(r,o)])>s){const e=(t[ke.getElementIndex(r,r)]-t[ke.getElementIndex(o,o)])/2/t[ke.getElementIndex(r,o)];let s;s=e<0?-1/(-e+Math.sqrt(1+e*e)):1/(e+Math.sqrt(1+e*e)),a=1/Math.sqrt(1+s*s),l=s*a}return Ot.IDENTITY.to(e),e[ke.getElementIndex(o,o)]=e[ke.getElementIndex(r,r)]=a,e[ke.getElementIndex(r,o)]=l,e[ke.getElementIndex(o,r)]=-l,e}const Ue=new ft.A,Ge=new ft.A,Ke=new ft.A,He=new ft.A,Qe=new ft.A,Je=new Ot,Xe={diagonal:new Ot,unitary:new Ot};var Ye=s(3276);const $e=512,ts=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],es=ts.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),ss=es.concat([[.25,.5],[.75,.5]]);class is{constructor(t,e,s){(0,i.A)(this,"x",void 0),(0,i.A)(this,"y",void 0),(0,i.A)(this,"z",void 0),(0,i.A)(this,"childVisible",void 0),(0,i.A)(this,"selected",void 0),(0,i.A)(this,"_children",void 0),this.x=t,this.y=e,this.z=s}get children(){if(!this._children){const t=2*this.x,e=2*this.y,s=this.z+1;this._children=[new is(t,e,s),new is(t,e+1,s),new is(t+1,e,s),new is(t+1,e+1,s)]}return this._children}update(t){const{viewport:e,cullingVolume:s,elevationBounds:i,minZ:n,maxZ:o,bounds:r,offset:a,project:l}=t,h=this.getBoundingVolume(i,a,l);if(r&&!this.insideBounds(r))return!1;if(s.computeVisibility(h)<0)return!1;if(!this.childVisible){let{z:t}=this;if(t<o&&t>=n){const s=h.distanceTo(e.cameraPosition)*e.scale/e.height;t+=Math.floor(Math.log2(s))}if(t>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const c of this.children)c.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const e of this._children)e.getSelected(t);return t}insideBounds([t,e,s,i]){const n=Math.pow(2,this.z),o=$e/n;return this.x*o<s&&this.y*o<i&&(this.x+1)*o>t&&(this.y+1)*o>e}getBoundingVolume(t,e,s){if(s){const e=this.z<1?ss:this.z<2?es:ts,i=[];for(const n of e){const e=ds(this.x+n[0],this.y+n[1],this.z);e[2]=t[0],i.push(s(e)),t[0]!==t[1]&&(e[2]=t[1],i.push(s(e)))}return function(t,e=new we){if(!t||0===t.length)return e.halfAxes=new Ot([0,0,0,0,0,0,0,0,0]),e.center=new ft.A,e;const s=t.length,i=new ft.A(0,0,0);for(const S of t)i.add(S);const n=1/s;i.multiplyByScalar(n);let o=0,r=0,a=0,l=0,h=0,c=0;for(const S of t){const t=Ue.copy(S).subtract(i);o+=t.x*t.x,r+=t.x*t.y,a+=t.x*t.z,l+=t.y*t.y,h+=t.y*t.z,c+=t.z*t.z}o*=n,r*=n,a*=n,l*=n,h*=n,c*=n;const u=Je;u[0]=o,u[1]=r,u[2]=a,u[3]=r,u[4]=l,u[5]=h,u[6]=a,u[7]=h,u[8]=c;const{unitary:d}=Fe(u,Xe),p=e.halfAxes.copy(d);let m=p.getColumn(0,Ke),g=p.getColumn(1,He),f=p.getColumn(2,Qe),y=-Number.MAX_VALUE,x=-Number.MAX_VALUE,A=-Number.MAX_VALUE,v=Number.MAX_VALUE,b=Number.MAX_VALUE,M=Number.MAX_VALUE;for(const S of t)Ue.copy(S),y=Math.max(Ue.dot(m),y),x=Math.max(Ue.dot(g),x),A=Math.max(Ue.dot(f),A),v=Math.min(Ue.dot(m),v),b=Math.min(Ue.dot(g),b),M=Math.min(Ue.dot(f),M);m=m.multiplyByScalar(.5*(v+y)),g=g.multiplyByScalar(.5*(b+x)),f=f.multiplyByScalar(.5*(M+A)),e.center.copy(m).add(g).add(f);const _=Ge.set(y-v,x-b,A-M).multiplyByScalar(.5),w=new Ot([_[0],0,0,0,_[1],0,0,0,_[2]]);return e.halfAxes.multiplyRight(w),e}(i)}const i=Math.pow(2,this.z),n=$e/i,o=this.x*n+e*$e,r=$e-(this.y+1)*n;return new At([o,r,t[0]],[o+n,r+n,t[1]])}}const ns=512,os=[-1/0,-1/0,1/0,1/0],rs={type:"object",value:null,validate:(t,e)=>e.optional&&null===t||"string"==typeof t||Array.isArray(t)&&t.every((t=>"string"==typeof t)),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const s=t.length;if(s!==e.length)return!1;for(let i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}};function as(t,e){const s=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...s.map((t=>t[0]))),Math.min(...s.map((t=>t[1]))),Math.max(...s.map((t=>t[0]))),Math.max(...s.map((t=>t[1])))]}function ls(t,e){if(!t||!t.length)return null;const{index:s,id:i}=e;if(Array.isArray(t)){t=t[(n=i,Math.abs(n.split("").reduce(((t,e)=>(t<<5)-t+e.charCodeAt(0)|0),0))%t.length)]}var n;let o=t;for(const r of Object.keys(s)){const t=new RegExp("{".concat(r,"}"),"g");o=o.replace(t,String(s[r]))}return Number.isInteger(s.y)&&Number.isInteger(s.z)&&(o=o.replace(/\{-y\}/g,String(Math.pow(2,s.z)-s.y-1))),o}function hs({viewport:t,z:e=0,cullRect:s}){return(t.subViewports||[t]).map((t=>cs(t,e||0,s)))}function cs(t,e,s){if(!Array.isArray(e)){const i=s.x-t.x,n=s.y-t.y,{width:o,height:r}=s,a={targetZ:e},l=t.unproject([i,n],a),h=t.unproject([i+o,n],a),c=t.unproject([i,n+r],a),u=t.unproject([i+o,n+r],a);return[Math.min(l[0],h[0],c[0],u[0]),Math.min(l[1],h[1],c[1],u[1]),Math.max(l[0],h[0],c[0],u[0]),Math.max(l[1],h[1],c[1],u[1])]}const i=cs(t,e[0],s),n=cs(t,e[1],s);return[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[2],n[2]),Math.max(i[3],n[3])]}function us(t,e){return Math.pow(2,t)*ns/e}function ds(t,e,s){const i=us(s,ns),n=t/i*360-180,o=Math.PI-2*Math.PI*e/i;return[n,180/Math.PI*Math.atan(.5*(Math.exp(o)-Math.exp(-o)))]}function ps(t,e,s,i){const n=us(s,i);return[t/n*ns,e/n*ns]}function ms(t,e,s,i,n=ns){if(t.isGeospatial){const[t,n]=ds(e,s,i),[o,r]=ds(e+1,s+1,i);return{west:t,north:n,east:o,south:r}}const[o,r]=ps(e,s,i,n),[a,l]=ps(e+1,s+1,i,n);return{left:o,top:r,right:a,bottom:l}}function gs(t,e,s,i,n){const o=function(t,e,s){let i;if(e&&2===e.length){const[s,n]=e,o=t.getBounds({z:s}),r=t.getBounds({z:n});i=[Math.min(o[0],r[0]),Math.min(o[1],r[1]),Math.max(o[2],r[2]),Math.max(o[3],r[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],s[0]),Math.max(i[1],s[1]),Math.min(i[2],s[2]),Math.min(i[3],s[3])]:[Math.max(Math.min(i[0],s[2]),s[0]),Math.max(Math.min(i[1],s[3]),s[1]),Math.min(Math.max(i[2],s[0]),s[2]),Math.min(Math.max(i[3],s[1]),s[3])]}(t,null,i),r=us(e,s),[a,l,h,c]=function(t,e,s){if(s)return as(t,s).map((t=>t*e/ns));return t.map((t=>t*e/ns))}(o,r,n),u=[];for(let d=Math.floor(a);d<h;d++)for(let t=Math.floor(l);t<c;t++)u.push({x:d,y:t,z:e});return u}function fs({viewport:t,maxZoom:e,minZoom:s,zRange:i,extent:n,tileSize:o=ns,modelMatrix:r,modelMatrixInverse:a,zoomOffset:l=0}){let h=t.isGeospatial?Math.round(t.zoom+Math.log2(ns/o))+l:Math.ceil(t.zoom)+l;if("number"==typeof s&&Number.isFinite(s)&&h<s){if(!n)return[];h=s}"number"==typeof e&&Number.isFinite(e)&&h>e&&(h=e);let c=n;return r&&a&&n&&!t.isGeospatial&&(c=as(n,r)),t.isGeospatial?function(t,e,s,i){const n=t instanceof ct&&t.resolution?t.projectPosition:null,o=Object.values(t.getFrustumPlanes()).map((({normal:t,distance:e})=>new Pe(t.clone().negate(),e))),r=new Re(o),a=t.distanceScales.unitsPerMeter[2],l=s&&s[0]*a||0,h=s&&s[1]*a||0,c=t instanceof dt.A&&t.pitch<=60?e:0;if(i){const[t,e,s,n]=i,o=(0,Ye.Gw)([t,n]),r=(0,Ye.Gw)([s,e]);i=[o[0],$e-o[1],r[0],$e-r[1]]}const u=new is(0,0,0),d={viewport:t,project:n,cullingVolume:r,elevationBounds:[l,h],minZ:c,maxZ:e,bounds:i,offset:0};if(u.update(d),t instanceof dt.A&&t.subViewports&&t.subViewports.length>1){for(d.offset=-1;u.update(d)&&!(--d.offset<-3););for(d.offset=1;u.update(d)&&!(++d.offset>3););}return u.getSelected()}(t,h,i,n):gs(t,h,o,c||os,a)}function ys(t,e){if(t===e)return!0;if(Array.isArray(t)){const s=t.length;if(!e||e.length!==s)return!1;for(let i=0;i<s;i++)if(t[i]!==e[i])return!1;return!0}return!1}const xs="never",As="no-overlap",vs="best-available",bs={[vs]:function(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!_s(e)&&ws(e);for(const e of t)e.isVisible=Boolean(2&e.state)},[As]:function(t){for(const s of t)s.state=0;for(const s of t)s.isSelected&&_s(s);const e=Array.from(t).sort(((t,e)=>t.zoom-e.zoom));for(const s of e)if(s.isVisible=Boolean(2&s.state),s.children&&(s.isVisible||1&s.state))for(const t of s.children)t.state=1;else s.isSelected&&ws(s)},[xs]:()=>{}},Ms={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};function _s(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=2,!0;e=e.parent}return!1}function ws(t){for(const e of t.children)e.isLoaded||e.content?e.state|=2:ws(e)}const Ss={TilesetClass:class{constructor(t){(0,i.A)(this,"opts",void 0),(0,i.A)(this,"_requestScheduler",void 0),(0,i.A)(this,"_cache",void 0),(0,i.A)(this,"_dirty",void 0),(0,i.A)(this,"_tiles",void 0),(0,i.A)(this,"_cacheByteSize",void 0),(0,i.A)(this,"_viewport",void 0),(0,i.A)(this,"_zRange",void 0),(0,i.A)(this,"_selectedTiles",void 0),(0,i.A)(this,"_frameNumber",void 0),(0,i.A)(this,"_modelMatrix",void 0),(0,i.A)(this,"_modelMatrixInverse",void 0),(0,i.A)(this,"_maxZoom",void 0),(0,i.A)(this,"_minZoom",void 0),(0,i.A)(this,"onTileLoad",void 0),(0,i.A)(this,"_getCullBounds",function(t){let e,s={};return i=>{for(const n in i)if(!ys(i[n],s[n])){e=t(i),s=i;break}return e}}(hs)),this.opts={...Ms,...t},this.onTileLoad=t=>{var e,s;null===(e=(s=this.opts).onTileLoad)||void 0===e||e.call(s,t),this.opts.maxCacheByteSize&&(this._cacheByteSize+=t.byteLength,this._resizeCache())},this._requestScheduler=new Y({maxRequests:t.maxRequests,throttleRequests:Boolean(t.maxRequests&&t.maxRequests>0)}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new $.A,this._modelMatrixInverse=new $.A,this.setOptions(t)}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return null!==this._selectedTiles&&this._selectedTiles.every((t=>t.isLoaded))}get needsReload(){return null!==this._selectedTiles&&this._selectedTiles.some((t=>t.needsReload))}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(const t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const t of this._cache.keys()){const e=this._cache.get(t);this._selectedTiles&&this._selectedTiles.includes(e)?e.setNeedsReload():this._cache.delete(t)}}update(t,{zRange:e,modelMatrix:s}={zRange:null,modelMatrix:null}){const i=s?new $.A(s):new $.A,n=!i.equals(this._modelMatrix);if(this._viewport&&t.equals(this._viewport)&&(0,tt.aI)(this._zRange,e)&&!n)this.needsReload&&(this._selectedTiles=this._selectedTiles.map((t=>this._getTile(t.index,!0))));else{n&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=t,this._zRange=e;const s=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:e,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=s.map((t=>this._getTile(t,!0))),this._dirty&&this._rebuildTree()}const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(t,e){if(!t.isVisible)return!1;if(e&&this._viewport){const s=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:e}),{bbox:i}=t;for(const[t,e,n,o]of s){let s;if("west"in i)s=i.west<n&&i.east>t&&i.south<o&&i.north>e;else{const r=Math.min(i.top,i.bottom),a=Math.max(i.top,i.bottom);s=i.left<n&&i.right>t&&r<o&&a>e}if(s)return!0}return!1}return!0}getTileIndices({viewport:t,maxZoom:e,minZoom:s,zRange:i,modelMatrix:n,modelMatrixInverse:o}){const{tileSize:r,extent:a,zoomOffset:l}=this.opts;return fs({viewport:t,maxZoom:e,minZoom:s,zRange:i,tileSize:r,extent:a,modelMatrix:n,modelMatrixInverse:o,zoomOffset:l})}getTileId(t){return"".concat(t.x,"-").concat(t.y,"-").concat(t.z)}getTileZoom(t){return t.z}getTileMetadata(t){const{tileSize:e}=this.opts;return{bbox:ms(this._viewport,t.x,t.y,t.z,e)}}getParentIndex(t){return{x:Math.floor(t.x/2),y:Math.floor(t.y/2),z:t.z-1}}updateTileStates(){const t=this.opts.refinementStrategy||vs,e=new Array(this._cache.size);let s=0;for(const i of this._cache.values())e[s++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;("function"==typeof t?t:bs[t])(Array.from(this._cache.values())),s=0;for(const i of this._cache.values())if(e[s++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:t=0}=this.opts,e=[];let s=0;for(const i of this._cache.values())i.isLoading&&(s++,i.isSelected||i.isVisible||e.push(i));for(;t>0&&s>t&&e.length>0;){e.shift().abort(),s--}}_rebuildTree(){const{_cache:t}=this;for(const e of t.values())e.parent=null,e.children&&(e.children.length=0);for(const e of t.values()){const t=this._getNearestAncestor(e);e.parent=t,null!=t&&t.children&&t.children.push(e)}}_resizeCache(){const{_cache:t,opts:e}=this,s=e.maxCacheSize||(e.maxCacheByteSize?1/0:5*this.selectedTiles.length),i=e.maxCacheByteSize||1/0;if(t.size>s||this._cacheByteSize>i){for(const[r,a]of t){var n,o;if(!a.isVisible&&!a.isSelected)this._cacheByteSize-=e.maxCacheByteSize?a.byteLength:0,t.delete(r),null===(n=(o=this.opts).onTileUnload)||void 0===n||n.call(o,a);if(t.size<=s&&this._cacheByteSize<=i)break}this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort(((t,e)=>t.zoom-e.zoom)),this._dirty=!1)}_getTile(t,e){const s=this.getTileId(t);let i=this._cache.get(s),n=!1;return!i&&e?(i=new et(t),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:s,zoom:this.getTileZoom(i.index)}),n=!0,this._cache.set(s,i),this._dirty=!0):i&&i.needsReload&&(n=!0),i&&n&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(t){const{_minZoom:e=0}=this;let s=t.index;for(;this.getTileZoom(s)>e;){s=this.getParentIndex(s);const t=this._getTile(s);if(t)return t}return null}},data:{type:"data",value:[]},dataComparator:rs.equal,renderSubLayers:{type:"function",value:t=>new Q(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:vs,zRange:null,maxRequests:6,zoomOffset:0};class Ts extends n.A{constructor(...t){super(...t),(0,i.A)(this,"state",void 0)}initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var t,e;null===(t=this.state)||void 0===t||null===(e=t.tileset)||void 0===e||e.finalize()}get isLoaded(){var t,e,s;return Boolean(null===(t=this.state)||void 0===t||null===(e=t.tileset)||void 0===e||null===(s=e.selectedTiles)||void 0===s?void 0:s.every((t=>t.isLoaded&&t.layers&&t.layers.every((t=>t.isLoaded)))))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:e}=this.state;const s=t.propsOrDataChanged||t.updateTriggersChanged,i=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);e?s&&(e.setOptions(this._getTilesetOptions()),i?e.reloadAll():e.tiles.forEach((t=>{t.layers=null}))):(e=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:e})),this._updateTileset()}_getTilesetOptions(){const{tileSize:t,maxCacheSize:e,maxCacheByteSize:s,refinementStrategy:i,extent:n,maxZoom:o,minZoom:r,maxRequests:a,zoomOffset:l}=this.props;return{maxCacheSize:e,maxCacheByteSize:s,maxZoom:o,minZoom:r,tileSize:t,refinementStrategy:i,extent:n,maxRequests:a,zoomOffset:l,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const t=this.state.tileset,{zRange:e,modelMatrix:s}=this.props,i=t.update(this.context.viewport,{zRange:e,modelMatrix:s}),{isLoaded:n}=t,o=this.state.isLoaded!==n,r=this.state.frameNumber!==i;n&&(o||r)&&this._onViewportLoad(),r&&this.setState({frameNumber:i}),this.state.isLoaded=n}_onViewportLoad(){const{tileset:t}=this.state,{onViewportLoad:e}=this.props;e&&e(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,e){this.props.onTileError(t),e.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){const{data:e,getTileData:s,fetch:i}=this.props,{signal:n}=t;return t.url="string"==typeof e||Array.isArray(e)?ls(e,t):null,s?s(t):i&&t.url?i(t.url,{propName:"data",layer:this,signal:n}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo({info:t,sourceLayer:e}){const s=e.props.tile;return t.picked&&(t.tile=s),t.sourceTile=s,t}_updateAutoHighlight(t){const e=t.sourceTile;if(e&&e.layers)for(const s of e.layers)s.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map((t=>{const e=this.getSubLayerPropsByTile(t);if(t.isLoaded||t.content)if(t.layers)e&&t.layers[0]&&Object.keys(e).some((s=>t.layers[0].props[s]!==e[s]))&&(t.layers=t.layers.map((t=>t.clone(e))));else{const s=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:t.id,updateTriggers:this.props.updateTriggers}),data:t.content,_offset:0,tile:t});t.layers=(0,z.B)(s,Boolean).map((s=>s.clone({tile:t,...e})))}else;return t.layers}))}filterSubLayer({layer:t,cullRect:e}){const{tile:s}=t.props;return this.state.tileset.isTileVisible(s,e)}}(0,i.A)(Ts,"defaultProps",Ss),(0,i.A)(Ts,"layerName","TileLayer");const Cs=[1],Ps={...Ts.defaultProps,elevationData:rs,texture:{...rs,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[L]};function Ls(t){return Array.isArray(t)?t.join(";"):t||""}class zs extends n.A{constructor(...t){super(...t),(0,i.A)(this,"state",void 0)}updateState({props:t,oldProps:e}){const s=t.elevationData!==e.elevationData;if(s){const{elevationData:e}=t,s=e&&(Array.isArray(e)||e.includes("{x}")&&e.includes("{y}"));this.setState({isTiled:s})}const i=s||t.meshMaxError!==e.meshMaxError||t.elevationDecoder!==e.elevationDecoder||t.bounds!==e.bounds;if(!this.state.isTiled&&i){const e=this.loadTerrain(t);this.setState({terrain:e})}t.workerUrl&&o.A.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:t,bounds:e,elevationDecoder:s,meshMaxError:i,signal:n}){var o;if(!t)return null;let r=this.getLoadOptions();r={...r,terrain:{skirtHeight:this.state.isTiled?2*i:0,...null===(o=r)||void 0===o?void 0:o.terrain,bounds:e,meshMaxError:i,elevationDecoder:s}};const{fetch:a}=this.props;return a(t,{propName:"elevationData",layer:this,loadOptions:r,signal:n})}getTiledTerrainData(t){const{elevationData:e,fetch:s,texture:i,elevationDecoder:n,meshMaxError:o}=this.props,{viewport:r}=this.context,a=ls(e,t),l=i&&ls(i,t),{signal:h}=t;let c=[0,0],u=[0,0];if(r.isGeospatial){const e=t.bbox;c=r.projectFlat([e.west,e.south]),u=r.projectFlat([e.east,e.north])}else{const e=t.bbox;c=[e.left,e.bottom],u=[e.right,e.top]}const d=[c[0],c[1],u[0],u[1]],p=this.loadTerrain({elevationData:a,bounds:d,elevationDecoder:n,meshMaxError:o,signal:h}),m=l?s(l,{propName:"texture",layer:this,loaders:[],signal:h}).catch((t=>null)):Promise.resolve(null);return Promise.all([p,m])}renderSubLayers(t){const e=this.getSubLayerClass("mesh",P),{color:s,wireframe:i,material:n}=this.props,{data:o}=t;if(!o)return null;const[r,a]=o;return new e(t,{data:Cs,mesh:r,texture:a,_instanced:!1,coordinateSystem:y.rf.CARTESIAN,getPosition:t=>[0,0,0],getColor:s,wireframe:i,material:n})}onViewportLoad(t){if(!t)return;const{zRange:e}=this.state,s=t.map((t=>t.content)).filter(Boolean).map((t=>t[0].header.boundingBox.map((t=>t[2]))));if(0===s.length)return;const i=Math.min(...s.map((t=>t[0]))),n=Math.max(...s.map((t=>t[1])));(!e||i<e[0]||n>e[1])&&this.setState({zRange:[i,n]})}renderLayers(){const{color:t,material:e,elevationData:s,texture:i,wireframe:n,meshMaxError:o,elevationDecoder:r,tileSize:a,maxZoom:l,minZoom:h,extent:c,maxRequests:u,onTileLoad:d,onTileUnload:p,onTileError:m,maxCacheSize:g,maxCacheByteSize:f,refinementStrategy:y}=this.props;if(this.state.isTiled)return new Ts(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:Ls(s),texture:Ls(i),meshMaxError:o,elevationDecoder:r}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:a,maxZoom:l,minZoom:h,extent:c,maxRequests:u,onTileLoad:d,onTileUnload:p,onTileError:m,maxCacheSize:g,maxCacheByteSize:f,refinementStrategy:y});if(!s)return null;return new(this.getSubLayerClass("mesh",P))(this.getSubLayerProps({id:"mesh"}),{data:Cs,mesh:this.state.terrain,texture:i,_instanced:!1,getPosition:t=>[0,0,0],getColor:t,material:e,wireframe:n})}}(0,i.A)(zs,"defaultProps",Ps),(0,i.A)(zs,"layerName","TerrainLayer")}}]);